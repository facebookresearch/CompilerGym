<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Getting Started &mdash; CompilerGym 0.2.5 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="About" href="about.html" />
    <link rel="prev" title="Indices and tables" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html">
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.2.5
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#key-concepts">Key Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-compilergym">Using CompilerGym</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#selecting-an-environment">Selecting an environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-compiler-environment">The compiler environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interacting-with-the-environment">Interacting with the environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-the-command-line-tools">Using the command line tools</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="rpc.html">RPC Service Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Environments</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="llvm/index.html">LLVM Environment Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="envs/gcc.html">GCC Environment Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="envs/loop_tool.html">loop_tool Environment Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="envs/mlir.html">MLIR Environment Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="compiler_gym/compiler_gym.html">compiler_gym</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler_gym/datasets.html">compiler_gym.datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler_gym/envs.html">compiler_gym.envs</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler_gym/envs/gcc.html">compiler_gym.envs.gcc</a></li>
<li class="toctree-l1"><a class="reference internal" href="llvm/api.html">compiler_gym.envs.llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler_gym/leaderboard.html">compiler_gym.leaderboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler_gym/service.html">compiler_gym.service</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler_gym/service/runtime.html">compiler_gym.service.runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler_gym/spaces.html">compiler_gym.spaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler_gym/views.html">compiler_gym.views</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler_gym/wrappers.html">compiler_gym.wrappers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">C++ API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cc/compiler_gym/envs/llvm/service.html">compiler_gym/envs/llvm/service</a></li>
<li class="toctree-l1"><a class="reference internal" href="cc/compiler_gym/service.html">compiler_gym/service</a></li>
<li class="toctree-l1"><a class="reference internal" href="cc/compiler_gym/service/runtime.html">compiler_gym/service/runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="cc/compiler_gym/util.html">compiler_gym/util</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CompilerGym</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Getting Started</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/getting_started.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this heading"></a></h1>
<a class="reference external image-reference" href="https://colab.research.google.com/github/facebookresearch/CompilerGym/blob/stable/examples/getting-started.ipynb"><img alt="https://colab.research.google.com/assets/colab-badge.svg" src="https://colab.research.google.com/assets/colab-badge.svg" /></a>
<p>CompilerGym is a toolkit for applying reinforcement learning to compiler
optimization tasks. This document provides a short walkthrough of the key
concepts, using the codesize reduction task of a production-grade compiler
as an example. It will take about 20 minutes to work through. Lets get
started!</p>
<div class="contents local topic" id="topics-covered">
<p class="topic-title">Topics covered:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#key-concepts" id="id3">Key Concepts</a></p></li>
<li><p><a class="reference internal" href="#using-compilergym" id="id4">Using CompilerGym</a></p>
<ul>
<li><p><a class="reference internal" href="#selecting-an-environment" id="id5">Selecting an environment</a></p></li>
<li><p><a class="reference internal" href="#the-compiler-environment" id="id6">The compiler environment</a></p></li>
<li><p><a class="reference internal" href="#interacting-with-the-environment" id="id7">Interacting with the environment</a></p></li>
<li><p><a class="reference internal" href="#using-the-command-line-tools" id="id8">Using the command line tools</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#next-steps" id="id9">Next Steps</a></p></li>
</ul>
</div>
<section id="key-concepts">
<h2><a class="toc-backref" href="#id3">Key Concepts</a><a class="headerlink" href="#key-concepts" title="Permalink to this heading"></a></h2>
<p>CompilerGym exposes compiler optimization problems as environments for
reinforcement learning. It uses the <a class="reference external" href="https://gym.openai.com/">OpenAI Gym</a>
interface to expose the “agent-environment loop” of reinforcement learning:</p>
<img alt="_images/overview.png" src="_images/overview.png" />
<p>The ingredients for reinforcement learning that CompilerGym provides are:</p>
<ul class="simple">
<li><p><strong>Environment</strong>: a compiler optimization task. For example,
<em>optimizing a C++ graph-traversal program for codesize using LLVM</em>. The
environment encapsulates an instance of a compiler and a particular program
that is being compiled. As an agent interacts with the environment, the state
of the program, and the compiler, can change.</p></li>
<li><p><strong>Action Space</strong>: the actions that may be taken at the current environment
state. For example, this could be a set of optimization transformations that
the compiler can apply to the program.</p></li>
<li><p><strong>Observation</strong>: a view of the current environment state. For example, this
could be the Intermediate Representation (IR) of the program that is being
compiled. The types of observations that are available depend on the compiler.</p></li>
<li><p><strong>Reward</strong>: a metric indicating the quality of the previous action. For
example, for a codesize optimization task this could be the change to the
number of instructions of the previous action.</p></li>
</ul>
<p>A single instance of this “agent-environment loop” represents the compilation of
a particular program. The goal is to develop an agent that maximises the
cumulative reward from these environments so as to produce the best programs.</p>
<p>Install the latest CompilerGym release using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">U</span> <span class="n">compiler_gym</span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://github.com/facebookresearch/CompilerGym/blob/development/INSTALL.md">INSTALL.md</a>
for alternative installation methods.</p>
</section>
<section id="using-compilergym">
<h2><a class="toc-backref" href="#id4">Using CompilerGym</a><a class="headerlink" href="#using-compilergym" title="Permalink to this heading"></a></h2>
<p>Begin by firing up a python interpreter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span>
</pre></div>
</div>
<p>To start with we import the gym module and the CompilerGym environments:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">gym</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">compiler_gym</span>
</pre></div>
</div>
<p>Importing <code class="xref py py-mod docutils literal notranslate"><span class="pre">compiler_gym</span></code> automatically registers the compiler environments.</p>
<p>We can see what environments are available using:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">compiler_gym</span><span class="o">.</span><span class="n">COMPILER_GYM_ENVS</span>
<span class="go">[&#39;llvm-v0&#39;, &#39;llvm-ic-v0&#39;, &#39;llvm-autophase-ic-v0&#39;, &#39;llvm-ir-ic-v0&#39;]</span>
</pre></div>
</div>
<section id="selecting-an-environment">
<h3><a class="toc-backref" href="#id5">Selecting an environment</a><a class="headerlink" href="#selecting-an-environment" title="Permalink to this heading"></a></h3>
<p>CompilerGym environments are named using one of the following formats:</p>
<ol class="arabic simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">&lt;compiler&gt;-&lt;observation&gt;-&lt;reward&gt;-&lt;version&gt;</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&lt;compiler&gt;-&lt;reward&gt;-&lt;version&gt;</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">&lt;compiler&gt;-&lt;version&gt;</span></code></p></li>
</ol>
<p>Where <code class="code docutils literal notranslate"><span class="pre">&lt;compiler&gt;</span></code> identifiers the compiler optimization task,
<code class="code docutils literal notranslate"><span class="pre">&lt;observation&gt;</span></code> is the default type of observations that are provided,
and <code class="code docutils literal notranslate"><span class="pre">&lt;reward&gt;</span></code> is the reward signal.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A key concept is that CompilerGym environments enables <strong>lazy evaluation</strong>
of observations and reward signals. This increases computational efficiency
sampling for scenarios in which you do not need to compute a reward or
observation for every step. If an environment omits a <code class="code docutils literal notranslate"><span class="pre">&lt;observation&gt;</span></code>
or <code class="code docutils literal notranslate"><span class="pre">&lt;reward&gt;</span></code> tag, this means that no observation or reward is
provided by default. See <a class="reference internal" href="compiler_gym/views.html"><span class="doc">compiler_gym.views</span></a> for
further details.</p>
</div>
<p>For this tutorial, we will use the following environment:</p>
<ul class="simple">
<li><p><strong>Compiler</strong>: <a class="reference internal" href="llvm/index.html"><span class="doc">LLVM</span></a>.</p></li>
<li><p><strong>Observation Type</strong>: <a class="reference internal" href="llvm/index.html#autophase"><span class="std std-ref">Autophase</span></a>.</p></li>
<li><p><strong>Reward Signal</strong>: <a class="reference internal" href="llvm/index.html#codesize"><span class="std std-ref">IR Instruction count relative to -Oz</span></a>.</p></li>
</ul>
<p>Create an instance of this environment using:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s2">&quot;llvm-autophase-ic-v0&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The first time you run <code class="code docutils literal notranslate"><span class="pre">gym.make()</span></code> you may see a logging message
“Downloading &lt;url&gt; …” followed by a delay of 1-2 minutes. This is
CompilerGym downloading large environment-specific dependencies that are not
shipped by default to keep the size of the package down. This is a one-off
download that occurs only the first time the environment is used. Other
operations that require one-off downloads include installing datasets
(described below).</p>
</div>
</section>
<section id="the-compiler-environment">
<h3><a class="toc-backref" href="#id6">The compiler environment</a><a class="headerlink" href="#the-compiler-environment" title="Permalink to this heading"></a></h3>
<p>If you have experience using <a class="reference external" href="https://gym.openai.com/">OpenAI Gym</a>, the
CompilerGym environments will be familiar. If not, you can call <code class="code docutils literal notranslate"><span class="pre">help()</span></code>
on any function, object, or method to query the documentation:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">help</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
</pre></div>
</div>
<p>The action space is described by
<a class="reference internal" href="compiler_gym/envs.html#compiler_gym.envs.CompilerEnv.action_space" title="compiler_gym.envs.CompilerEnv.action_space"><code class="xref py py-meth docutils literal notranslate"><span class="pre">env.action_space</span></code></a>.
The <a class="reference internal" href="llvm/index.html#action-space"><span class="std std-ref">LLVM Action Space</span></a> is discrete:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">dtype</span>
<span class="go">dtype(&#39;int64&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">n</span>
<span class="go">138</span>
</pre></div>
</div>
<p>The observation space is described by
<a class="reference internal" href="compiler_gym/envs.html#compiler_gym.envs.CompilerEnv.observation_space" title="compiler_gym.envs.CompilerEnv.observation_space"><code class="xref py py-meth docutils literal notranslate"><span class="pre">env.observation_space</span></code></a>.
The <a class="reference internal" href="llvm/index.html#autophase"><span class="std std-ref">Autophase</span></a> observation space is a 56-dimension
vector of integers:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">observation_space</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(56,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">observation_space</span><span class="o">.</span><span class="n">dtype</span>
<span class="go">dtype(&#39;int64&#39;)</span>
</pre></div>
</div>
<p>The upper and lower bounds of the reward signal are described by
<a class="reference internal" href="compiler_gym/envs.html#compiler_gym.envs.CompilerEnv.reward_range" title="compiler_gym.envs.CompilerEnv.reward_range"><code class="xref py py-meth docutils literal notranslate"><span class="pre">env.reward_range</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">reward_range</span>
<span class="go">(0.0, inf)</span>
</pre></div>
</div>
<p>As with other Gym environments, <a class="reference internal" href="compiler_gym/envs.html#compiler_gym.envs.CompilerEnv.reset" title="compiler_gym.envs.CompilerEnv.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reset()</span></code></a> must be called before a CompilerGym
environment may be used.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="go">array([  0,   4,  54,  39,  12,  46,  23,   6,  12,  31,   2,   4,   0,</span>
<span class="go">        81,   4,  77,  13,  15, 108, 106,  75,  51,  71,  46,  15,   0,</span>
<span class="go">         9,  46,   0,  13,  72,  51,  77,  81,  39,  31,   0, 163,   2,</span>
<span class="go">         0,   4,   6,  13,   1,   0,  73,   8,   1,   0,  15,  85, 638,</span>
<span class="go">       402,  16,  10, 298])</span>
</pre></div>
</div>
<p>The numpy array that is returned by <a class="reference internal" href="compiler_gym/envs.html#compiler_gym.envs.CompilerEnv.reset" title="compiler_gym.envs.CompilerEnv.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reset()</span></code></a> is the initial observation of the program
state. This value, along with the entire dynamics of the environment, depends on
the particular program that is being compiled. In CompilerGym these programs are
called <strong>benchmarks</strong>. You can see which benchmark is currently being used by an
environment using <a class="reference internal" href="compiler_gym/envs.html#compiler_gym.envs.CompilerEnv.benchmark" title="compiler_gym.envs.CompilerEnv.benchmark"><code class="xref py py-attr docutils literal notranslate"><span class="pre">env.benchmark</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">benchmark</span>
<span class="go">benchmark://cbench-v1/qsort</span>
</pre></div>
</div>
<p>If we want to compile a different program, we can pass the name of a benchmark
to <a class="reference internal" href="compiler_gym/envs.html#compiler_gym.envs.CompilerEnv.reset" title="compiler_gym.envs.CompilerEnv.reset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">env.reset()</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">benchmark</span><span class="o">=</span><span class="s2">&quot;benchmark://npb-v0/50&quot;</span><span class="p">)</span>
<span class="go">array([   0,    0,   26,   25,    1,   26,   10,    1,    8,   10,    0,</span>
<span class="go">          0,    0,   37,    0,   36,    0,    2,   46,  175, 1664, 1212,</span>
<span class="go">        263,   26,  193,    0,   59,    6,    0,    3,   32,    0,   36,</span>
<span class="go">         10, 1058,   10,    0,  840,    0,    0,    0,    1,  416,    0,</span>
<span class="go">          0,  148,   60,    0,    0,    0,   37, 3008, 2062,    9,    0,</span>
<span class="go">       1262])</span>
</pre></div>
</div>
<p>We provide over <a class="reference internal" href="llvm/index.html#datasets"><span class="std std-ref">a million benchmarks for the LLVM environments</span></a> that can be used for training agents and evaluating the
generalization of strategies across unseen programs. Benchmarks are grouped into
<em>datasets</em> , which are managed using <a class="reference internal" href="compiler_gym/datasets.html#compiler_gym.datasets.Datasets" title="compiler_gym.datasets.Datasets"><code class="xref py py-class docutils literal notranslate"><span class="pre">env.datasets</span></code></a>. You may also provide your own programs to use
as benchmarks, see <a class="reference internal" href="compiler_gym/envs.html#compiler_gym.envs.LlvmEnv.make_benchmark" title="compiler_gym.envs.LlvmEnv.make_benchmark"><code class="xref py py-meth docutils literal notranslate"><span class="pre">env.make_benchmark()</span></code></a> for details.</p>
</section>
<section id="interacting-with-the-environment">
<h3><a class="toc-backref" href="#id7">Interacting with the environment</a><a class="headerlink" href="#interacting-with-the-environment" title="Permalink to this heading"></a></h3>
<p>Once an environment has been initialized, you interact with it in the same way
that you would with any other <a class="reference external" href="https://gym.openai.com/">OpenAI Gym</a>
environment. <a class="reference internal" href="compiler_gym/envs.html#compiler_gym.envs.LlvmEnv.render" title="compiler_gym.envs.LlvmEnv.render"><code class="xref py py-meth docutils literal notranslate"><span class="pre">env.render()</span></code></a> prints
the Intermediate Representation (IR) of the program in the current state:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
<span class="go">; ModuleID = &#39;benchmark://npb-v0/83&#39;</span>
<span class="go">target datalayout = &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot;</span>
<span class="go">target triple = &quot;x86_64-pc-linux-gnu&quot;</span>
<span class="gp">...</span>
</pre></div>
</div>
<p><a class="reference internal" href="compiler_gym/envs.html#compiler_gym.envs.CompilerEnv.step" title="compiler_gym.envs.CompilerEnv.step"><code class="xref py py-meth docutils literal notranslate"><span class="pre">env.step()</span></code></a> runs an action:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">observation</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>This returns four values: a new observation, a reward, a boolean value
indicating whether the episode has ended, and a dictionary of additional
information:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">observation</span>
<span class="go">array([   0,    0,   26,   25,    1,   26,   10,    1,    8,   10,    0,</span>
<span class="go">          0,    0,   37,    0,   36,    0,    2,   46,  175, 1664, 1212,</span>
<span class="go">        263,   26,  193,    0,   59,    6,    0,    3,   32,    0,   36,</span>
<span class="go">         10, 1058,   10,    0,  840,    0,    0,    0,    1,  416,    0,</span>
<span class="go">          0,  148,   60,    0,    0,    0,   37, 3008, 2062,    9,    0,</span>
<span class="go">       1262])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reward</span>
<span class="go">0.3151595744680851</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">done</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">info</span>
<span class="go">{&#39;action_had_no_effect&#39;: True, &#39;new_action_space&#39;: False}</span>
</pre></div>
</div>
<p>For this environment, reward represents the reduction in code size of the
previous action, scaled to the total codesize reduction achieved with LLVM’s
<code class="code docutils literal notranslate"><span class="pre">-Oz</span></code> optimizations enabled. A cumulative reward greater than one means
that the sequence of optimizations performed yields better results than LLVM’s
default optimizations. Let’s run 100 random actions and see how close we can
get:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">benchmark</span><span class="o">=</span><span class="s2">&quot;benchmark://npb-v0/50&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">episode_reward</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">101</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">observation</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">())</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">break</span>
<span class="gp">... </span>    <span class="n">episode_reward</span> <span class="o">+=</span> <span class="n">reward</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, quality=</span><span class="si">{</span><span class="n">episode_reward</span><span class="si">:</span><span class="s2">.3%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">Step 1, quality=44.299%</span>
<span class="go">Step 2, quality=44.299%</span>
<span class="go">Step 3, quality=44.299%</span>
<span class="go">Step 4, quality=44.299%</span>
<span class="go">Step 5, quality=44.299%</span>
<span class="go">Step 6, quality=54.671%</span>
<span class="go">Step 7, quality=54.671%</span>
<span class="go">Step 8, quality=54.608%</span>
<span class="go">Step 9, quality=54.608%</span>
<span class="go">Step 10, quality=54.608%</span>
<span class="go">Step 11, quality=54.608%</span>
<span class="go">Step 12, quality=54.766%</span>
<span class="go">Step 13, quality=54.766%</span>
<span class="go">Step 14, quality=53.650%</span>
<span class="go">Step 15, quality=53.650%</span>
<span class="gp">...</span>
<span class="go">Step 97, quality=88.104%</span>
<span class="go">Step 98, quality=88.104%</span>
<span class="go">Step 99, quality=88.104%</span>
<span class="go">Step 100, quality=88.104%</span>
</pre></div>
</div>
<p>Not bad, but clearly there is room for improvement! Because at each step we are
taking random actions, your results will differ with every run. Try running it
again. Was the result better or worse? Of course, there may be better ways of
selecting actions than choosing randomly, but for the purpose of this tutorial
we will leave that as an exercise for the reader :)</p>
<p>Before we finish, lets use
<a class="reference internal" href="compiler_gym/envs.html#compiler_gym.envs.CompilerEnv.commandline" title="compiler_gym.envs.CompilerEnv.commandline"><code class="xref py py-meth docutils literal notranslate"><span class="pre">env.commandline()</span></code></a>
to produce an LLVM <code class="code docutils literal notranslate"><span class="pre">opt</span></code> command line invocation that is equivalent to
the sequence of actions we just run:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">commandline</span><span class="p">()</span>
<span class="go">&#39;opt -consthoist -sancov -inferattrs ... -place-safepoints input.bc -o output.bc&#39;</span>
</pre></div>
</div>
<p>We can also save the program in its current state for future reference:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">write_bitcode</span><span class="p">(</span><span class="s2">&quot;~/program.bc&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Once we are finished, we must close the environment to end the compiler
session:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>And finally we are done with our python session:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">exit</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Internally, CompilerGym environments may launch subprocesses and use
temporary files to communicate between the environment and the underlying
compiler (see <a class="reference internal" href="compiler_gym/service.html"><span class="doc">compiler_gym.service</span></a> for
details). This means it is important to call <a class="reference internal" href="compiler_gym/envs.html#compiler_gym.envs.CompilerEnv.close" title="compiler_gym.envs.CompilerEnv.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">env.close()</span></code></a> after use to free up resources and
prevent orphan subprocesses or files. We recommend using the <code class="code docutils literal notranslate"><span class="pre">with</span></code>
statement pattern for creating environments:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s2">&quot;llvm-autophase-ic-v0&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">env</span><span class="p">:</span>
<span class="gp">... </span>   <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="gp">... </span>   <span class="c1"># use env how you like</span>
</pre></div>
</div>
<p>This removes the need to call <a class="reference internal" href="compiler_gym/envs.html#compiler_gym.envs.CompilerEnv.close" title="compiler_gym.envs.CompilerEnv.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">env.close()</span></code></a> yourself.</p>
</div>
</section>
<section id="using-the-command-line-tools">
<h3><a class="toc-backref" href="#id8">Using the command line tools</a><a class="headerlink" href="#using-the-command-line-tools" title="Permalink to this heading"></a></h3>
<p>CompilerGym includes a set of useful <a class="reference internal" href="cli.html"><span class="doc">command line tools</span></a>. Each of
the steps above could be replicated from the command line.</p>
<p>For example, <a class="reference internal" href="cli.html#module-compiler_gym.bin.service" title="compiler_gym.bin.service"><code class="xref py py-mod docutils literal notranslate"><span class="pre">compiler_gym.bin.service</span></code></a> can be used to list the available
environments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m compiler_gym.bin.service --ls_env
llvm-v0
...
</pre></div>
</div>
<p>And to describe the capabilities of each environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m compiler_gym.bin.service --env=llvm-v0

Datasets
--------

+----------------------------+--------------------------+------------------------------+
| Dataset                    | Num. Benchmarks [#f1]_   | Description                  |
+============================+==========================+==============================+
| benchmark://anghabench-v0  | 1,042,976                | Compile-only C/C++ functions |
+----------------------------+--------------------------+------------------------------+
| benchmark://blas-v0        | 300                      | Basic linear algebra kernels |
+----------------------------+--------------------------+------------------------------+
...

Observation Spaces
------------------

+--------------------------+----------------------------------------------+
| Observation space        | Shape                                        |
+==========================+==============================================+
| Autophase                | `Box(0, 9223372036854775807, (56,), int64)`  |
+--------------------------+----------------------------------------------+
| AutophaseDict            | `Dict(ArgsPhi:int&lt;0,inf&gt;, BB03Phi:int&lt;0,...` |
+--------------------------+----------------------------------------------+
| BitcodeFile              | `str_list&lt;&gt;[0,4096.0])`                      |
+--------------------------+----------------------------------------------+
...
</pre></div>
</div>
<p>The <a class="reference internal" href="cli.html#module-compiler_gym.bin.manual_env" title="compiler_gym.bin.manual_env"><code class="xref py py-mod docutils literal notranslate"><span class="pre">compiler_gym.bin.manual_env</span></code></a> module provides an interactive text user
interface for CompilerGym environments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m compiler_gym.bin.manual_env --env=llvm-v0
Initialized environment in 144.3ms
Welcome to the CompilerGym Shell!
---------------------------------
Type help or ? for more information.
The &#39;tutorial&#39; command will give a step by step guide.

compiler_gym:cbench-v1/qsort&gt; help

Documented commands (type help &lt;topic&gt;):
========================================
action       help               list_rewards     set_default_observation
back         hill_climb         observation      set_default_reward
breakpoint   list_actions       require_dataset  simplify_stack
commandline  list_benchmarks    reset            stack
exit         list_datasets      reward           try_all_actions
greedy       list_observations  set_benchmark    tutorial
</pre></div>
</div>
<p>Finally, the <a class="reference internal" href="cli.html#module-compiler_gym.bin.random_search" title="compiler_gym.bin.random_search"><code class="xref py py-mod docutils literal notranslate"><span class="pre">compiler_gym.bin.random_search</span></code></a> module provides a simple but
efficient implementation for randomly searching the optimization space:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m compiler_gym.bin.random_search --env=llvm-autophase-ic-v0 --benchmark=npb-v0/50 --runtime=10
Started 24 worker threads for using reward IrInstructionCountOz.
Writing logs to /home/user/logs/compiler_gym/random/npb-v0/50/2021-04-21T16:42:41.038447
=== Running for 10 seconds ===
Runtime: 10 seconds. Num steps: 21,563 (2,105 / sec). Num episodes: 141 (13 / sec). Num restarts: 0.
Best reward: 1.0228 (141 passes, found after 4 seconds)

Ending worker threads ... done
Replaying actions from best solution found:
Step [001 / 141]: reward=0.0000         episode=0.0000          action=-hotcoldsplit
Step [002 / 141]: reward=0.0000         episode=0.0000          action=-scalarizer
Step [003 / 141]: reward=0.0000         episode=0.0000          action=-redundant-dbg-inst-elim
...
Step [139 / 141]: reward=0.0000         episode=1.0218          action=-barrier
Step [140 / 141]: reward=0.0000         episode=1.0218          action=-sink
Step [141 / 141]: reward=0.0010         episode=1.0228          action=-loop-simplifycfg
+---------------------------+-------+-------+---------+
|                           |   -O0 |   -Oz |   final |
+===========================+=======+=======+=========+
| IR instruction count      |  3008 |   948 |     901 |
+---------------------------+-------+-------+---------+
| Object .text size (bytes) | 13047 | 10991 |   10399 |
+---------------------------+-------+-------+---------+
</pre></div>
</div>
<p>To beat the compiler by 2.28% after 10 seconds of random trials is not bad
going!</p>
</section>
</section>
<section id="next-steps">
<h2><a class="toc-backref" href="#id9">Next Steps</a><a class="headerlink" href="#next-steps" title="Permalink to this heading"></a></h2>
<p>Now that you have got to grips with the compiler environment, take a browse
through the <a class="reference external" href="https://github.com/facebookresearch/CompilerGym/tree/stable/examples">examples directory</a> for
pytorch integration, agent implementations, etc. Then check out <a class="reference external" href="https://github.com/facebookresearch/CompilerGym#leaderboards">the
leaderboards</a> to
see what the best performing algorithms are, and <a class="reference external" href="https://facebookresearch.github.io/CompilerGym/">the documentation</a> for details of the APIs and
environments. We love feedback, bug reports, and feature requests - please <a class="reference external" href="https://github.com/facebookresearch/CompilerGym/issues/new/choose">file
an issue</a>!</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Indices and tables" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="about.html" class="btn btn-neutral float-right" title="About" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Meta Platforms, Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WJN2CKJJKH"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-WJN2CKJJKH', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>