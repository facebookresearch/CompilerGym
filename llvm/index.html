<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LLVM Environment Reference &mdash; CompilerGym 0.2.5 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.png"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="GCC Environment Reference" href="../envs/gcc.html" />
    <link rel="prev" title="Frequently Asked Questions" href="../faq.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.2.5
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Command Line Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rpc.html">RPC Service Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Environments</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">LLVM Environment Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#datasets">Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#observation-spaces">Observation Spaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#llvm-ir">LLVM-IR</a></li>
<li class="toctree-l3"><a class="reference internal" href="#instcount">InstCount</a></li>
<li class="toctree-l3"><a class="reference internal" href="#autophase">Autophase</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inst2vec">Inst2vec</a></li>
<li class="toctree-l3"><a class="reference internal" href="#programl">ProGraML</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hardware-information">Hardware Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cost-models">Cost Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#runtime">Runtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-time">Build Time</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#reward-spaces">Reward Spaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ir-instruction-count">IR Instruction Count</a></li>
<li class="toctree-l3"><a class="reference internal" href="#codesize">Codesize</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#action-space">Action Space</a></li>
<li class="toctree-l2"><a class="reference internal" href="#faq">FAQ</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#is-this-really-a-sequential-decision-process">Is this really a sequential decision process?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#when-does-the-environment-consider-an-episode-done">When does the environment consider an episode “done”?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-do-i-run-this-on-my-own-program">How do I run this on my own program?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#should-i-always-try-different-actions">Should I always try different actions?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../envs/gcc.html">GCC Environment Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../envs/loop_tool.html">loop_tool Environment Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../envs/mlir.html">MLIR Environment Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../compiler_gym/compiler_gym.html">compiler_gym</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compiler_gym/datasets.html">compiler_gym.datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compiler_gym/envs.html">compiler_gym.envs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compiler_gym/envs/gcc.html">compiler_gym.envs.gcc</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">compiler_gym.envs.llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compiler_gym/leaderboard.html">compiler_gym.leaderboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compiler_gym/service.html">compiler_gym.service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compiler_gym/service/runtime.html">compiler_gym.service.runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compiler_gym/spaces.html">compiler_gym.spaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compiler_gym/views.html">compiler_gym.views</a></li>
<li class="toctree-l1"><a class="reference internal" href="../compiler_gym/wrappers.html">compiler_gym.wrappers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">C++ API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cc/compiler_gym/envs/llvm/service.html">compiler_gym/envs/llvm/service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cc/compiler_gym/service.html">compiler_gym/service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cc/compiler_gym/service/runtime.html">compiler_gym/service/runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cc/compiler_gym/util.html">compiler_gym/util</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CompilerGym</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>LLVM Environment Reference</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/llvm/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="llvm-environment-reference">
<h1>LLVM Environment Reference<a class="headerlink" href="#llvm-environment-reference" title="Permalink to this heading"></a></h1>
<p><a class="reference external" href="https://llvm.org/">LLVM</a> is a production-grade compiler used throughout
industry. It defines a machine independent intermediate representation (IR), and
comprises a family of tools with frontends for C, C++, OpenCL, and many other
languages.</p>
<p>CompilerGym exposes the LLVM IR optimizer for reinforcement learning through an
<a class="reference internal" href="../compiler_gym/envs.html#compiler_gym.envs.LlvmEnv" title="compiler_gym.envs.LlvmEnv"><code class="xref py py-class docutils literal notranslate"><span class="pre">LlvmEnv</span></code></a> environment.</p>
<div class="contents local topic" id="overview">
<p class="topic-title">Overview:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#installation" id="id4">Installation</a></p></li>
<li><p><a class="reference internal" href="#datasets" id="id5">Datasets</a></p></li>
<li><p><a class="reference internal" href="#observation-spaces" id="id6">Observation Spaces</a></p>
<ul>
<li><p><a class="reference internal" href="#llvm-ir" id="id7">LLVM-IR</a></p></li>
<li><p><a class="reference internal" href="#instcount" id="id8">InstCount</a></p></li>
<li><p><a class="reference internal" href="#autophase" id="id9">Autophase</a></p></li>
<li><p><a class="reference internal" href="#inst2vec" id="id10">Inst2vec</a></p></li>
<li><p><a class="reference internal" href="#programl" id="id11">ProGraML</a></p></li>
<li><p><a class="reference internal" href="#hardware-information" id="id12">Hardware Information</a></p></li>
<li><p><a class="reference internal" href="#cost-models" id="id13">Cost Models</a></p></li>
<li><p><a class="reference internal" href="#runtime" id="id14">Runtime</a></p></li>
<li><p><a class="reference internal" href="#build-time" id="id15">Build Time</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#reward-spaces" id="id16">Reward Spaces</a></p>
<ul>
<li><p><a class="reference internal" href="#ir-instruction-count" id="id17">IR Instruction Count</a></p></li>
<li><p><a class="reference internal" href="#codesize" id="id18">Codesize</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#action-space" id="id19">Action Space</a></p></li>
<li><p><a class="reference internal" href="#faq" id="id20">FAQ</a></p>
<ul>
<li><p><a class="reference internal" href="#is-this-really-a-sequential-decision-process" id="id21">Is this really a sequential decision process?</a></p></li>
<li><p><a class="reference internal" href="#when-does-the-environment-consider-an-episode-done" id="id22">When does the environment consider an episode “done”?</a></p></li>
<li><p><a class="reference internal" href="#how-do-i-run-this-on-my-own-program" id="id23">How do I run this on my own program?</a></p></li>
<li><p><a class="reference internal" href="#should-i-always-try-different-actions" id="id24">Should I always try different actions?</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="installation">
<h2><a class="toc-backref" href="#id4">Installation</a><a class="headerlink" href="#installation" title="Permalink to this heading"></a></h2>
<p>The LLVM environments are self-installing and work out of the box. A pack of
required runtime data is downloaded and cached on first use of the environments.</p>
</section>
<section id="datasets">
<h2><a class="toc-backref" href="#id5">Datasets</a><a class="headerlink" href="#datasets" title="Permalink to this heading"></a></h2>
<p>We provide several datasets of open-source LLVM-IR benchmarks for use:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 9%" />
<col style="width: 74%" />
<col style="width: 8%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Dataset</p></th>
<th class="head"><p>Num. Benchmarks <a class="footnote-reference brackets" href="#f1" id="id1">1</a></p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Validatable <a class="footnote-reference brackets" href="#f2" id="id2">2</a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>benchmark://anghabench-v1</p></td>
<td><p>1,041,333</p></td>
<td><p>Compile-only C/C++ functions extracted from GitHub [<a class="reference external" href="http://cuda.dcc.ufmg.br/angha/">Homepage</a>, <a class="reference external" href="https://homepages.dcc.ufmg.br/~fernando/publications/papers/FaustinoCGO21.pdf">Paper</a>]</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p>benchmark://blas-v0</p></td>
<td><p>300</p></td>
<td><p>Basic linear algebra kernels [<a class="reference external" href="http://www.netlib.org/blas/">Homepage</a>, <a class="reference external" href="https://strum355.netsoc.co/books/PDF/Basic%20Linear%20Algebra%20Subprograms%20for%20Fortran%20Usage%20-%20BLAS%20(1979).pdf">Paper</a>]</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p>benchmark://cbench-v1</p></td>
<td><p>23</p></td>
<td><p>Runnable C benchmarks [<a class="reference external" href="https://ctuning.org/wiki/index.php/CTools:CBench">Homepage</a>, <a class="reference external" href="https://arxiv.org/pdf/1407.3487.pdf">Paper</a>]</p></td>
<td><p>Partially</p></td>
</tr>
<tr class="row-odd"><td><p>benchmark://chstone-v0</p></td>
<td><p>12</p></td>
<td><p>Benchmarks for C-based High-Level Synthesis [<a class="reference external" href="http://www.ertl.jp/chstone/">Homepage</a>, <a class="reference external" href="http://www.yxi.com/applications/iscas2008-300_1027.pdf">Paper</a>]</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p>benchmark://clgen-v0</p></td>
<td><p>996</p></td>
<td><p>Synthetically generated OpenCL kernels [<a class="reference external" href="https://github.com/ChrisCummins/clgen">Homepage</a>, <a class="reference external" href="https://chriscummins.cc/pub/2017-cgo.pdf">Paper</a>]</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p>benchmark://github-v0</p></td>
<td><p>49,738</p></td>
<td><p>Compile-only C/C++ objects from GitHub [<a class="reference external" href="https://arxiv.org/pdf/2012.01470.pdf">Paper</a>]</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p>benchmark://jotaibench-v0</p></td>
<td><p>18,761</p></td>
<td><p>Compile-only C/C++ functions extracted from GitHub [<a class="reference external" href="https://github.com/lac-dcc/jotai-benchmarks">Homepage</a>]</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p>benchmark://linux-v0</p></td>
<td><p>13,894</p></td>
<td><p>Compile-only object files from C Linux kernel [<a class="reference external" href="https://www.linux.org/">Homepage</a>]</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p>benchmark://mibench-v1</p></td>
<td><p>40</p></td>
<td><p>C benchmarks [<a class="reference external" href="http://vhosts.eecs.umich.edu/mibench/Publications/MiBench.pdf">Paper</a>]</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p>benchmark://npb-v0</p></td>
<td><p>122</p></td>
<td><p>NASA Parallel Benchmarks [<a class="reference external" href="http://optout.csc.ncsu.edu/~mueller/codeopt/codeopt05/projects/www4.ncsu.edu/~pgauria/csc791a/papers/NAS-95-020.pdf">Paper</a>]</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p>benchmark://opencv-v0</p></td>
<td><p>442</p></td>
<td><p>Compile-only object files from C++ OpenCV library [<a class="reference external" href="https://opencv.org/">Homepage</a>, <a class="reference external" href="https://mipro-proceedings.com/sites/mipro-proceedings.com/files/upload/sp/sp_008.pdf">Paper</a>]</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p>benchmark://poj104-v1</p></td>
<td><p>49,816</p></td>
<td><p>Solutions to programming programs [<a class="reference external" href="https://sites.google.com/site/treebasedcnn/">Homepage</a>, <a class="reference external" href="https://ojs.aaai.org/index.php/AAAI/article/download/10139/9998">Paper</a>]</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p>benchmark://tensorflow-v0</p></td>
<td><p>1,985</p></td>
<td><p>Compile-only object files from C++ TensorFlow library [<a class="reference external" href="https://www.tensorflow.org/">Homepage</a>, <a class="reference external" href="https://www.usenix.org/system/files/conference/osdi16/osdi16-abadi.pdf">Paper</a>]</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p>generator://csmith-v0</p></td>
<td><p>∞</p></td>
<td><p>Random conformant C99 programs [<a class="reference external" href="https://embed.cs.utah.edu/csmith/">Homepage</a>, <a class="reference external" href="http://web.cse.ohio-state.edu/~rountev.1/5343/pdf/pldi11.pdf">Paper</a>]</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p>generator://llvm-stress-v0</p></td>
<td><p>∞</p></td>
<td><p>Randomly generated LLVM-IR [<a class="reference external" href="https://llvm.org/docs/CommandGuide/llvm-stress.html">Documentation</a>]</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p>Total</p></td>
<td><p>1,177,462</p></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<dl class="footnote brackets">
<dt class="label" id="f1"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Values are for the Linux datasets. Some of the datasets contain fewer
benchmarks on macOS.</p>
</dd>
<dt class="label" id="f2"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>A <strong>validatable</strong> dataset is one where the behavior of the benchmarks
can be checked by compiling the programs to binaries and executing
them. If the benchmarks crash, or are found to have different behavior,
then validation fails. This type of validation is used to check that
the compiler has not broken the semantics of the program.
See <a class="reference internal" href="../cli.html#module-compiler_gym.bin.validate" title="compiler_gym.bin.validate"><code class="xref py py-mod docutils literal notranslate"><span class="pre">compiler_gym.bin.validate</span></code></a>.</p>
</dd>
</dl>
<p>All of the above datasets are available for use with the LLVM environment. See
<a class="reference internal" href="api.html#datasets"><span class="std std-ref">compiler_gym.envs.llvm.datasets</span></a> for API details.</p>
<p>We characterize the datasets below in radial plots which show, clockwise from
the top: the average number of instructions per benchmark, the density of
branching instructions, the density of memory operations, and the density of
arithmetic instructions. For example, comparing blas-v0 and cbench-v1 shows that
blas-v0 consists of smaller programs with a similar density of branches, a
higher density of arithmetic operations and relatively few memory operations.
cbench-v1, in contrast to the small linear algebra kernels of blas-v0, contains
larger programs with a higher density of memory operations and fewer arithmetic
operations.</p>
<img alt="../_images/datasets.png" src="../_images/datasets.png" />
</section>
<section id="observation-spaces">
<h2><a class="toc-backref" href="#id6">Observation Spaces</a><a class="headerlink" href="#observation-spaces" title="Permalink to this heading"></a></h2>
<p>We provide several observation spaces for LLVM based on published compiler
research.</p>
<section id="llvm-ir">
<h3><a class="toc-backref" href="#id7">LLVM-IR</a><a class="headerlink" href="#llvm-ir" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 51%" />
<col style="width: 49%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Observation space</p></th>
<th class="head"><p>Shape</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Ir</p></td>
<td><p><cite>str_list&lt;&gt;[0,inf])</cite></p></td>
</tr>
<tr class="row-odd"><td><p>BitcodeFile</p></td>
<td><p><cite>str_list&lt;&gt;[0,4096.0])</cite></p></td>
</tr>
</tbody>
</table>
<p>A serialized representation of the LLVM-IR can be accessed as a string through
the <code class="code docutils literal notranslate"><span class="pre">Ir</span></code> observation space:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">observation</span><span class="p">[</span><span class="s2">&quot;Ir&quot;</span><span class="p">]</span>
<span class="go">&#39;; ModuleID = \&#39;benchmark://npb-v0/50\&#39;\n ...&quot;use-soft-float&quot;=&quot;false&quot; }\n&#39;</span>
</pre></div>
</div>
<p>Alternatively the module can be serialized to a bitcode file on disk:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">observation</span><span class="p">[</span><span class="s2">&quot;BitcodeFile&quot;</span><span class="p">]</span>
<span class="go">&#39;/home/user/.cache/compiler_gym/service/2020-12-21T11:55:41.716711-6f4f0669/module-5a8b9fcf.bc&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Files generated by the <code class="code docutils literal notranslate"><span class="pre">BitcodeFile</span></code> observation space are put in a
temporary directory that is removed when <a class="reference internal" href="../compiler_gym/envs.html#compiler_gym.envs.CompilerEnv.close" title="compiler_gym.envs.CompilerEnv.close"><code class="xref py py-meth docutils literal notranslate"><span class="pre">env.close()</span></code></a> is called.</p>
</div>
</section>
<section id="instcount">
<h3><a class="toc-backref" href="#id8">InstCount</a><a class="headerlink" href="#instcount" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 1%" />
<col style="width: 99%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Observation space</p></th>
<th class="head"><p>Shape</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>InstCount</p></td>
<td><p><cite>Box(0, 9223372036854775807, (70,), int64)</cite></p></td>
</tr>
<tr class="row-odd"><td><p>InstCountDict</p></td>
<td><p><cite>Dict(AShrCount:int&lt;0,inf&gt;, AddCount:int&lt;0,inf&gt;, AddrSpaceCastCount:int&lt;0,inf&gt;, AllocaCount:int&lt;0,inf&gt;, AndCount:int&lt;0,inf&gt;, AtomicCmpXchgCount:int&lt;0,inf&gt;, AtomicRMWCount:int&lt;0,inf&gt;, BitCastCount:int&lt;0,inf&gt;, BrCount:int&lt;0,inf&gt;, CallBrCount:int&lt;0,inf&gt;, CallCount:int&lt;0,inf&gt;, CatchPadCount:int&lt;0,inf&gt;, CatchRetCount:int&lt;0,inf&gt;, CatchSwitchCount:int&lt;0,inf&gt;, CleanupPadCount:int&lt;0,inf&gt;, CleanupRetCount:int&lt;0,inf&gt;, ExtractElementCount:int&lt;0,inf&gt;, ExtractValueCount:int&lt;0,inf&gt;, FAddCount:int&lt;0,inf&gt;, FCmpCount:int&lt;0,inf&gt;, FDivCount:int&lt;0,inf&gt;, FMulCount:int&lt;0,inf&gt;, FNegCount:int&lt;0,inf&gt;, FPExtCount:int&lt;0,inf&gt;, FPToSICount:int&lt;0,inf&gt;, FPToUICount:int&lt;0,inf&gt;, FPTruncCount:int&lt;0,inf&gt;, FRemCount:int&lt;0,inf&gt;, FSubCount:int&lt;0,inf&gt;, FenceCount:int&lt;0,inf&gt;, FreezeCount:int&lt;0,inf&gt;, GetElementPtrCount:int&lt;0,inf&gt;, ICmpCount:int&lt;0,inf&gt;, IndirectBrCount:int&lt;0,inf&gt;, InsertElementCount:int&lt;0,inf&gt;, InsertValueCount:int&lt;0,inf&gt;, IntToPtrCount:int&lt;0,inf&gt;, InvokeCount:int&lt;0,inf&gt;, LShrCount:int&lt;0,inf&gt;, LandingPadCount:int&lt;0,inf&gt;, LoadCount:int&lt;0,inf&gt;, MulCount:int&lt;0,inf&gt;, OrCount:int&lt;0,inf&gt;, PHICount:int&lt;0,inf&gt;, PtrToIntCount:int&lt;0,inf&gt;, ResumeCount:int&lt;0,inf&gt;, RetCount:int&lt;0,inf&gt;, SDivCount:int&lt;0,inf&gt;, SExtCount:int&lt;0,inf&gt;, SIToFPCount:int&lt;0,inf&gt;, SRemCount:int&lt;0,inf&gt;, SelectCount:int&lt;0,inf&gt;, ShlCount:int&lt;0,inf&gt;, ShuffleVectorCount:int&lt;0,inf&gt;, StoreCount:int&lt;0,inf&gt;, SubCount:int&lt;0,inf&gt;, SwitchCount:int&lt;0,inf&gt;, TotalBlocksCount:int&lt;0,inf&gt;, TotalFuncsCount:int&lt;0,inf&gt;, TotalInstsCount:int&lt;0,inf&gt;, TruncCount:int&lt;0,inf&gt;, UDivCount:int&lt;0,inf&gt;, UIToFPCount:int&lt;0,inf&gt;, URemCount:int&lt;0,inf&gt;, UnreachableCount:int&lt;0,inf&gt;, UserOp1Count:int&lt;0,inf&gt;, UserOp2Count:int&lt;0,inf&gt;, VAArgCount:int&lt;0,inf&gt;, XorCount:int&lt;0,inf&gt;, ZExtCount:int&lt;0,inf&gt;)</cite></p></td>
</tr>
<tr class="row-even"><td><p>InstCountNorm</p></td>
<td><p><cite>Box(0.0, 1.0, (69,), float32)</cite></p></td>
</tr>
<tr class="row-odd"><td><p>InstCountNormDict</p></td>
<td><p><cite>Dict(AShrDensity:int&lt;0,inf&gt;, AddDensity:int&lt;0,inf&gt;, AddrSpaceCastDensity:int&lt;0,inf&gt;, AllocaDensity:int&lt;0,inf&gt;, AndDensity:int&lt;0,inf&gt;, AtomicCmpXchgDensity:int&lt;0,inf&gt;, AtomicRMWDensity:int&lt;0,inf&gt;, BitCastDensity:int&lt;0,inf&gt;, BrDensity:int&lt;0,inf&gt;, CallBrDensity:int&lt;0,inf&gt;, CallDensity:int&lt;0,inf&gt;, CatchPadDensity:int&lt;0,inf&gt;, CatchRetDensity:int&lt;0,inf&gt;, CatchSwitchDensity:int&lt;0,inf&gt;, CleanupPadDensity:int&lt;0,inf&gt;, CleanupRetDensity:int&lt;0,inf&gt;, ExtractElementDensity:int&lt;0,inf&gt;, ExtractValueDensity:int&lt;0,inf&gt;, FAddDensity:int&lt;0,inf&gt;, FCmpDensity:int&lt;0,inf&gt;, FDivDensity:int&lt;0,inf&gt;, FMulDensity:int&lt;0,inf&gt;, FNegDensity:int&lt;0,inf&gt;, FPExtDensity:int&lt;0,inf&gt;, FPToSIDensity:int&lt;0,inf&gt;, FPToUIDensity:int&lt;0,inf&gt;, FPTruncDensity:int&lt;0,inf&gt;, FRemDensity:int&lt;0,inf&gt;, FSubDensity:int&lt;0,inf&gt;, FenceDensity:int&lt;0,inf&gt;, FreezeDensity:int&lt;0,inf&gt;, GetElementPtrDensity:int&lt;0,inf&gt;, ICmpDensity:int&lt;0,inf&gt;, IndirectBrDensity:int&lt;0,inf&gt;, InsertElementDensity:int&lt;0,inf&gt;, InsertValueDensity:int&lt;0,inf&gt;, IntToPtrDensity:int&lt;0,inf&gt;, InvokeDensity:int&lt;0,inf&gt;, LShrDensity:int&lt;0,inf&gt;, LandingPadDensity:int&lt;0,inf&gt;, LoadDensity:int&lt;0,inf&gt;, MulDensity:int&lt;0,inf&gt;, OrDensity:int&lt;0,inf&gt;, PHIDensity:int&lt;0,inf&gt;, PtrToIntDensity:int&lt;0,inf&gt;, ResumeDensity:int&lt;0,inf&gt;, RetDensity:int&lt;0,inf&gt;, SDivDensity:int&lt;0,inf&gt;, SExtDensity:int&lt;0,inf&gt;, SIToFPDensity:int&lt;0,inf&gt;, SRemDensity:int&lt;0,inf&gt;, SelectDensity:int&lt;0,inf&gt;, ShlDensity:int&lt;0,inf&gt;, ShuffleVectorDensity:int&lt;0,inf&gt;, StoreDensity:int&lt;0,inf&gt;, SubDensity:int&lt;0,inf&gt;, SwitchDensity:int&lt;0,inf&gt;, TotalBlocksDensity:int&lt;0,inf&gt;, TotalFuncsDensity:int&lt;0,inf&gt;, TruncDensity:int&lt;0,inf&gt;, UDivDensity:int&lt;0,inf&gt;, UIToFPDensity:int&lt;0,inf&gt;, URemDensity:int&lt;0,inf&gt;, UnreachableDensity:int&lt;0,inf&gt;, UserOp1Density:int&lt;0,inf&gt;, UserOp2Density:int&lt;0,inf&gt;, VAArgDensity:int&lt;0,inf&gt;, XorDensity:int&lt;0,inf&gt;, ZExtDensity:int&lt;0,inf&gt;)</cite></p></td>
</tr>
</tbody>
</table>
<p>The InstCount observation space is a 70-dimension integer feature vector in the
range [0,∞]. The first three features are the total number of instructions, the
total number of basic blocks, and the total number of functions. The remaining
features are the number of instructions of each of the 67 different types in the
program.</p>
<p>Use the <code class="code docutils literal notranslate"><span class="pre">InstCount</span></code> observation space to access the feature vectors as an
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.array.html">np.array</a>,
and <code class="code docutils literal notranslate"><span class="pre">InstCountDict</span></code> to receive them as a self-documented dictionary, keyed
by the name of each feature.</p>
<p>The table below provides a description of each of the 70 features, with the
index in which they appear in the <code class="code docutils literal notranslate"><span class="pre">InstCount</span></code> and <code class="code docutils literal notranslate"><span class="pre">InstCountNorm</span></code>
spaces, and their name as they appear in the keys of the <code class="code docutils literal notranslate"><span class="pre">InstCountDict</span></code>
and <code class="code docutils literal notranslate"><span class="pre">InstCountNormDict</span></code> spaces. See the <a class="reference external" href="https://llvm.org/docs/LangRef.html#instruction-reference">LLVM instruction reference</a> for the meaning of
the counted instructions.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 34%" />
<col style="width: 54%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>TotalInsts</p></td>
<td><p>Total instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>TotalBlocks</p></td>
<td><p>Basic block count</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>TotalFuncs</p></td>
<td><p>Function count</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>Ret</p></td>
<td><p>Ret instruction count</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>Br</p></td>
<td><p>Br instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>Switch</p></td>
<td><p>Switch instruction count</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>IndirectBr</p></td>
<td><p>IndirectBr instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>Invoke</p></td>
<td><p>Invoke instruction count</p></td>
</tr>
<tr class="row-even"><td><p>8</p></td>
<td><p>Resume</p></td>
<td><p>Resume instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>9</p></td>
<td><p>Unreachable</p></td>
<td><p>Unreachable instruction count</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><p>CleanupRet</p></td>
<td><p>CleanupRet instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>11</p></td>
<td><p>CatchRet</p></td>
<td><p>CatchRet instruction count</p></td>
</tr>
<tr class="row-even"><td><p>12</p></td>
<td><p>CatchSwitch</p></td>
<td><p>CatchSwitch instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>13</p></td>
<td><p>CallBr</p></td>
<td><p>CallBr instruction count</p></td>
</tr>
<tr class="row-even"><td><p>14</p></td>
<td><p>FNeg</p></td>
<td><p>FNeg instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>15</p></td>
<td><p>Add</p></td>
<td><p>Add instruction count</p></td>
</tr>
<tr class="row-even"><td><p>16</p></td>
<td><p>FAdd</p></td>
<td><p>FAdd instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>17</p></td>
<td><p>Sub</p></td>
<td><p>Sub instruction count</p></td>
</tr>
<tr class="row-even"><td><p>18</p></td>
<td><p>FSub</p></td>
<td><p>FSub instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>19</p></td>
<td><p>Mul</p></td>
<td><p>Mul instruction count</p></td>
</tr>
<tr class="row-even"><td><p>20</p></td>
<td><p>FMul</p></td>
<td><p>FMul instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>21</p></td>
<td><p>UDiv</p></td>
<td><p>UDiv instruction count</p></td>
</tr>
<tr class="row-even"><td><p>22</p></td>
<td><p>SDiv</p></td>
<td><p>SDiv instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>23</p></td>
<td><p>FDiv</p></td>
<td><p>FDiv instruction count</p></td>
</tr>
<tr class="row-even"><td><p>24</p></td>
<td><p>URem</p></td>
<td><p>URem instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>25</p></td>
<td><p>SRem</p></td>
<td><p>SRem instruction count</p></td>
</tr>
<tr class="row-even"><td><p>26</p></td>
<td><p>FRem</p></td>
<td><p>FRem instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>27</p></td>
<td><p>Shl</p></td>
<td><p>Shl instruction count</p></td>
</tr>
<tr class="row-even"><td><p>28</p></td>
<td><p>LShr</p></td>
<td><p>LShr instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>29</p></td>
<td><p>AShr</p></td>
<td><p>AShr instruction count</p></td>
</tr>
<tr class="row-even"><td><p>30</p></td>
<td><p>And</p></td>
<td><p>And instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>31</p></td>
<td><p>Or</p></td>
<td><p>Or instruction count</p></td>
</tr>
<tr class="row-even"><td><p>32</p></td>
<td><p>Xor</p></td>
<td><p>Xor instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>33</p></td>
<td><p>Alloca</p></td>
<td><p>Alloca instruction count</p></td>
</tr>
<tr class="row-even"><td><p>34</p></td>
<td><p>Load</p></td>
<td><p>Load instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>35</p></td>
<td><p>Store</p></td>
<td><p>Store instruction count</p></td>
</tr>
<tr class="row-even"><td><p>36</p></td>
<td><p>GetElementPtr</p></td>
<td><p>GetElementPtr instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>37</p></td>
<td><p>Fence</p></td>
<td><p>Fence instruction count</p></td>
</tr>
<tr class="row-even"><td><p>38</p></td>
<td><p>AtomicCmpXchg</p></td>
<td><p>AtomicCmpXchg instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>39</p></td>
<td><p>AtomicRMW</p></td>
<td><p>AtomicRMW instruction count</p></td>
</tr>
<tr class="row-even"><td><p>40</p></td>
<td><p>Trunc</p></td>
<td><p>Trunc instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>41</p></td>
<td><p>ZExt</p></td>
<td><p>ZExt instruction count</p></td>
</tr>
<tr class="row-even"><td><p>42</p></td>
<td><p>SExt</p></td>
<td><p>SExt instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>43</p></td>
<td><p>FPToUI</p></td>
<td><p>FPToUI instruction count</p></td>
</tr>
<tr class="row-even"><td><p>44</p></td>
<td><p>FPToSI</p></td>
<td><p>FPToSI instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>45</p></td>
<td><p>UIToFP</p></td>
<td><p>UIToFP instruction count</p></td>
</tr>
<tr class="row-even"><td><p>46</p></td>
<td><p>SIToFP</p></td>
<td><p>SIToFP instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>47</p></td>
<td><p>FPTrunc</p></td>
<td><p>FPTrunc instruction count</p></td>
</tr>
<tr class="row-even"><td><p>48</p></td>
<td><p>FPExt</p></td>
<td><p>FPExt instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>49</p></td>
<td><p>PtrToInt</p></td>
<td><p>PtrToInt instruction count</p></td>
</tr>
<tr class="row-even"><td><p>50</p></td>
<td><p>IntToPtr</p></td>
<td><p>IntToPtr instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>51</p></td>
<td><p>BitCast</p></td>
<td><p>BitCast instruction count</p></td>
</tr>
<tr class="row-even"><td><p>52</p></td>
<td><p>AddrSpaceCast</p></td>
<td><p>AddrSpaceCast instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>53</p></td>
<td><p>CleanupPad</p></td>
<td><p>CleanupPad instruction count</p></td>
</tr>
<tr class="row-even"><td><p>54</p></td>
<td><p>CatchPad</p></td>
<td><p>CatchPad instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>55</p></td>
<td><p>ICmp</p></td>
<td><p>ICmp instruction count</p></td>
</tr>
<tr class="row-even"><td><p>56</p></td>
<td><p>FCmp</p></td>
<td><p>FCmp instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>57</p></td>
<td><p>PHI</p></td>
<td><p>PHI instruction count</p></td>
</tr>
<tr class="row-even"><td><p>58</p></td>
<td><p>Call</p></td>
<td><p>Call instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>59</p></td>
<td><p>Select</p></td>
<td><p>Select instruction count</p></td>
</tr>
<tr class="row-even"><td><p>60</p></td>
<td><p>UserOp1</p></td>
<td><p>UserOp1 instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>61</p></td>
<td><p>UserOp2</p></td>
<td><p>UserOp2 instruction count</p></td>
</tr>
<tr class="row-even"><td><p>62</p></td>
<td><p>VAArg</p></td>
<td><p>VAArg instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>63</p></td>
<td><p>ExtractElement</p></td>
<td><p>ExtractElement instruction count</p></td>
</tr>
<tr class="row-even"><td><p>64</p></td>
<td><p>InsertElement</p></td>
<td><p>InsertElement instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>65</p></td>
<td><p>ShuffleVector</p></td>
<td><p>ShuffleVector instruction count</p></td>
</tr>
<tr class="row-even"><td><p>66</p></td>
<td><p>ExtractValue</p></td>
<td><p>ExtractValue instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>67</p></td>
<td><p>InsertValue</p></td>
<td><p>InsertValue instruction count</p></td>
</tr>
<tr class="row-even"><td><p>68</p></td>
<td><p>LandingPad</p></td>
<td><p>LandingPad instruction count</p></td>
</tr>
<tr class="row-odd"><td><p>69</p></td>
<td><p>Freeze</p></td>
<td><p>Freeze instruction count</p></td>
</tr>
</tbody>
</table>
<p>Example values:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">observation</span><span class="p">[</span><span class="s2">&quot;InstCount&quot;</span><span class="p">]</span>
<span class="go">array([406198,  46981,   3795,   3712,  41629,   1489,      0,      0,</span>
<span class="go">            0,    151,      0,      0,      0,      0,     49,   5393,</span>
<span class="go">          301,   3548,    157,   1132,    748,    152,    296,    270,</span>
<span class="go">           42,     72,      0,   1228,    408,   1251,   2433,    878,</span>
<span class="go">         1022,  22963, 107948,  53284,  59136,      0,      0,      0,</span>
<span class="go">         2815,   7711,   3082,     14,    327,     16,    566,    328,</span>
<span class="go">          888,    844,      0,  32345,      0,      0,      0,  14341,</span>
<span class="go">          682,   1622,  30668,    257,      0,      0,      0,      0,</span>
<span class="go">            0,      0,      0,      0,      0,      0])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">observation</span><span class="p">[</span><span class="s2">&quot;InstCountDict&quot;</span><span class="p">]</span>
<span class="go">{&#39;TotalInstsCount&#39;: 406198, &#39;TotalBlocksCount&#39;: 46981, &#39;TotalFuncsCount&#39;:</span>
<span class="go">3795, &#39;RetCount&#39;: 3712, &#39;BrCount&#39;: 41629, &#39;SwitchCount&#39;: 1489,</span>
<span class="go">&#39;IndirectBrCount&#39;: 0, &#39;InvokeCount&#39;: 0, &#39;ResumeCount&#39;: 0,</span>
<span class="go">&#39;UnreachableCount&#39;: 151, &#39;CleanupRetCount&#39;: 0, &#39;CatchRetCount&#39;: 0,</span>
<span class="go">&#39;CatchSwitchCount&#39;: 0, &#39;CallBrCount&#39;: 0, &#39;FNegCount&#39;: 49, &#39;AddCount&#39;: 5393,</span>
<span class="go">&#39;FAddCount&#39;: 301, &#39;SubCount&#39;: 3548, &#39;FSubCount&#39;: 157, &#39;MulCount&#39;: 1132,</span>
<span class="go">&#39;FMulCount&#39;: 748, &#39;UDivCount&#39;: 152, &#39;SDivCount&#39;: 296, &#39;FDivCount&#39;: 270,</span>
<span class="go">&#39;URemCount&#39;: 42, &#39;SRemCount&#39;: 72, &#39;FRemCount&#39;: 0, &#39;ShlCount&#39;: 1228,</span>
<span class="go">&#39;LShrCount&#39;: 408, &#39;AShrCount&#39;: 1251, &#39;AndCount&#39;: 2433, &#39;OrCount&#39;: 878,</span>
<span class="go">&#39;XorCount&#39;: 1022, &#39;AllocaCount&#39;: 22963, &#39;LoadCount&#39;: 107948, &#39;StoreCount&#39;:</span>
<span class="go">53284, &#39;GetElementPtrCount&#39;: 59136, &#39;FenceCount&#39;: 0, &#39;AtomicCmpXchgCount&#39;:</span>
<span class="go">0, &#39;AtomicRMWCount&#39;: 0, &#39;TruncCount&#39;: 2815, &#39;ZExtCount&#39;: 7711, &#39;SExtCount&#39;:</span>
<span class="go">3082, &#39;FPToUICount&#39;: 14, &#39;FPToSICount&#39;: 327, &#39;UIToFPCount&#39;: 16,</span>
<span class="go">&#39;SIToFPCount&#39;: 566, &#39;FPTruncCount&#39;: 328, &#39;FPExtCount&#39;: 888, &#39;PtrToIntCount&#39;:</span>
<span class="go">844, &#39;IntToPtrCount&#39;: 0, &#39;BitCastCount&#39;: 32345, &#39;AddrSpaceCastCount&#39;: 0,</span>
<span class="go">&#39;CleanupPadCount&#39;: 0, &#39;CatchPadCount&#39;: 0, &#39;ICmpCount&#39;: 14341, &#39;FCmpCount&#39;:</span>
<span class="go">682, &#39;PHICount&#39;: 1622, &#39;CallCount&#39;: 30668, &#39;SelectCount&#39;: 257,</span>
<span class="go">&#39;UserOp1Count&#39;: 0, &#39;UserOp2Count&#39;: 0, &#39;VAArgCount&#39;: 0,</span>
<span class="go">&#39;ExtractElementCount&#39;: 0, &#39;InsertElementCount&#39;: 0, &#39;ShuffleVectorCount&#39;: 0,</span>
<span class="go">&#39;ExtractValueCount&#39;: 0, &#39;InsertValueCount&#39;: 0, &#39;LandingPadCount&#39;: 0,</span>
<span class="go">&#39;FreezeCount&#39;: 0}</span>
</pre></div>
</div>
<p>The derived spaces <code class="code docutils literal notranslate"><span class="pre">InstCountNorm</span></code> and <code class="code docutils literal notranslate"><span class="pre">InstCountNormDict</span></code> return
the instruction counts normalized to the total number of instructions (index 0
in the table above). The first feature is omitted, yield a 69-dimensionality
feature vector:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">observation</span><span class="p">[</span><span class="s2">&quot;InstCountNorm&quot;</span><span class="p">]</span>
<span class="go">array([1.1566034e-01, 9.3427347e-03, 9.1384007e-03, 1.0248450e-01,</span>
<span class="go">    3.6657001e-03, 0.0000000e+00, 0.0000000e+00, 0.0000000e+00,</span>
<span class="go">    3.7173988e-04, 0.0000000e+00, 0.0000000e+00, 0.0000000e+00,</span>
<span class="go">    0.0000000e+00, 1.2063082e-04, 1.3276776e-02, 7.4101792e-04,</span>
<span class="go">    8.7346565e-03, 3.8651100e-04, 2.7868182e-03, 1.8414665e-03,</span>
<span class="go">    3.7420174e-04, 7.2870863e-04, 6.6470046e-04, 1.0339785e-04,</span>
<span class="go">    1.7725346e-04, 0.0000000e+00, 3.0231562e-03, 1.0044363e-03,</span>
<span class="go">    3.0797787e-03, 5.9896898e-03, 2.1615075e-03, 2.5160143e-03,</span>
<span class="go">    5.6531545e-02, 2.6575217e-01, 1.3117741e-01, 1.4558417e-01,</span>
<span class="go">    0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 6.9301180e-03,</span>
<span class="go">    1.8983353e-02, 7.5874329e-03, 3.4465949e-05, 8.0502609e-04,</span>
<span class="go">    3.9389659e-05, 1.3934091e-03, 8.0748799e-04, 2.1861261e-03,</span>
<span class="go">    2.0778044e-03, 0.0000000e+00, 7.9628654e-02, 0.0000000e+00,</span>
<span class="go">    0.0000000e+00, 0.0000000e+00, 3.5305440e-02, 1.6789841e-03,</span>
<span class="go">    3.9931266e-03, 7.5500123e-02, 6.3269638e-04, 0.0000000e+00,</span>
<span class="go">    0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 0.0000000e+00,</span>
<span class="go">    0.0000000e+00, 0.0000000e+00, 0.0000000e+00, 0.0000000e+00,</span>
<span class="go">    0.0000000e+00], dtype=float32)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">observation</span><span class="p">[</span><span class="s2">&quot;InstCountNorm&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>The InstCount observation space and its derivatives are cheap to compute,
deterministic, and platform independent.</p>
</section>
<section id="autophase">
<h3><a class="toc-backref" href="#id9">Autophase</a><a class="headerlink" href="#autophase" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 2%" />
<col style="width: 98%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Observation space</p></th>
<th class="head"><p>Shape</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Autophase</p></td>
<td><p><cite>Box(0, 9223372036854775807, (56,), int64)</cite></p></td>
</tr>
<tr class="row-odd"><td><p>AutophaseDict</p></td>
<td><p><cite>Dict(ArgsPhi:int&lt;0,inf&gt;, BB03Phi:int&lt;0,inf&gt;, BBHiPhi:int&lt;0,inf&gt;, BBNoPhi:int&lt;0,inf&gt;, BBNumArgsHi:int&lt;0,inf&gt;, BBNumArgsLo:int&lt;0,inf&gt;, BeginPhi:int&lt;0,inf&gt;, BlockLow:int&lt;0,inf&gt;, BlockMid:int&lt;0,inf&gt;, BranchCount:int&lt;0,inf&gt;, CriticalCount:int&lt;0,inf&gt;, NumAShrInst:int&lt;0,inf&gt;, NumAddInst:int&lt;0,inf&gt;, NumAllocaInst:int&lt;0,inf&gt;, NumAndInst:int&lt;0,inf&gt;, NumBitCastInst:int&lt;0,inf&gt;, NumBrInst:int&lt;0,inf&gt;, NumCallInst:int&lt;0,inf&gt;, NumEdges:int&lt;0,inf&gt;, NumGetElementPtrInst:int&lt;0,inf&gt;, NumICmpInst:int&lt;0,inf&gt;, NumLShrInst:int&lt;0,inf&gt;, NumLoadInst:int&lt;0,inf&gt;, NumMulInst:int&lt;0,inf&gt;, NumOrInst:int&lt;0,inf&gt;, NumPHIInst:int&lt;0,inf&gt;, NumRetInst:int&lt;0,inf&gt;, NumSExtInst:int&lt;0,inf&gt;, NumSelectInst:int&lt;0,inf&gt;, NumShlInst:int&lt;0,inf&gt;, NumStoreInst:int&lt;0,inf&gt;, NumSubInst:int&lt;0,inf&gt;, NumTruncInst:int&lt;0,inf&gt;, NumXorInst:int&lt;0,inf&gt;, NumZExtInst:int&lt;0,inf&gt;, TotalBlocks:int&lt;0,inf&gt;, TotalFuncs:int&lt;0,inf&gt;, TotalInsts:int&lt;0,inf&gt;, TotalMemInst:int&lt;0,inf&gt;, UncondBranches:int&lt;0,inf&gt;, binaryConstArg:int&lt;0,inf&gt;, const32Bit:int&lt;0,inf&gt;, const64Bit:int&lt;0,inf&gt;, morePreds:int&lt;0,inf&gt;, numConstOnes:int&lt;0,inf&gt;, numConstZeroes:int&lt;0,inf&gt;, onePred:int&lt;0,inf&gt;, onePredOneSuc:int&lt;0,inf&gt;, onePredTwoSuc:int&lt;0,inf&gt;, oneSuccessor:int&lt;0,inf&gt;, returnInt:int&lt;0,inf&gt;, testUnary:int&lt;0,inf&gt;, twoEach:int&lt;0,inf&gt;, twoPred:int&lt;0,inf&gt;, twoPredOneSuc:int&lt;0,inf&gt;, twoSuccessor:int&lt;0,inf&gt;)</cite></p></td>
</tr>
</tbody>
</table>
<p>The Autophase observation space is a 56-dimension integer feature vector
summarizing the static LLVM-IR representation. It is described in:</p>
<blockquote>
<div><p>Haj-Ali, A., Huang, Q. J., Xiang, J., Moses, W., Asanovic, K., Wawrzynek,
J., &amp; Stoica, I. (2020).
<a class="reference external" href="https://proceedings.mlsys.org/paper/2020/file/4e732ced3463d06de0ca9a15b6153677-Paper.pdf">AutoPhase: Juggling HLS phase orderings in random forests with deep reinforcement learning</a>.
Proceedings of Machine Learning and Systems, 2, 70-81.</p>
</div></blockquote>
<p>Use the <code class="code docutils literal notranslate"><span class="pre">Autophase</span></code> observation space to access the feature vectors as an
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.array.html">np.array</a>,
and <code class="code docutils literal notranslate"><span class="pre">AutophaseDict</span></code> to receive them as a self-documented dictionary, keyed
by the name of each feature.</p>
<p>The table below provides a description of each of the 56 features, with the
index in which they appear in the <code class="code docutils literal notranslate"><span class="pre">Autophase</span></code> vector, and their name as
they appear in the keys of the <code class="code docutils literal notranslate"><span class="pre">AutophaseDict</span></code> dictionary.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 8%" />
<col style="width: 25%" />
<col style="width: 67%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Index</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>BBNumArgsHi</p></td>
<td><p>Number of BB where total args for phi nodes is gt 5</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>BBNumArgsLo</p></td>
<td><p>Number of BB where total args for phi nodes is [1, 5]</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>onePred</p></td>
<td><p>Number of basic blocks with 1 predecessor</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>onePredOneSuc</p></td>
<td><p>Number of basic blocks with 1 predecessor and 1 successor</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>onePredTwoSuc</p></td>
<td><p>Number of basic blocks with 1 predecessor and 2 successors</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>oneSuccessor</p></td>
<td><p>Number of basic blocks with 1 successor</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>twoPred</p></td>
<td><p>Number of basic blocks with 2 predecessors</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>twoPredOneSuc</p></td>
<td><p>Number of basic blocks with 2 predecessors and 1 successor</p></td>
</tr>
<tr class="row-even"><td><p>8</p></td>
<td><p>twoEach</p></td>
<td><p>Number of basic blocks with 2 predecessors and successors</p></td>
</tr>
<tr class="row-odd"><td><p>9</p></td>
<td><p>twoSuccessor</p></td>
<td><p>Number of basic blocks with 2 successors</p></td>
</tr>
<tr class="row-even"><td><p>10</p></td>
<td><p>morePreds</p></td>
<td><p>Number of basic blocks with gt. 2 predecessors</p></td>
</tr>
<tr class="row-odd"><td><p>11</p></td>
<td><p>BB03Phi</p></td>
<td><p>Number of basic blocks with Phi node count in range (0, 3]</p></td>
</tr>
<tr class="row-even"><td><p>12</p></td>
<td><p>BBHiPhi</p></td>
<td><p>Number of basic blocks with more than 3 Phi nodes</p></td>
</tr>
<tr class="row-odd"><td><p>13</p></td>
<td><p>BBNoPhi</p></td>
<td><p>Number of basic blocks with no Phi nodes</p></td>
</tr>
<tr class="row-even"><td><p>14</p></td>
<td><p>BeginPhi</p></td>
<td><p>Number of Phi-nodes at beginning of BB</p></td>
</tr>
<tr class="row-odd"><td><p>15</p></td>
<td><p>BranchCount</p></td>
<td><p>Number of branches</p></td>
</tr>
<tr class="row-even"><td><p>16</p></td>
<td><p>returnInt</p></td>
<td><p>Number of calls that return an int</p></td>
</tr>
<tr class="row-odd"><td><p>17</p></td>
<td><p>CriticalCount</p></td>
<td><p>Number of critical edges</p></td>
</tr>
<tr class="row-even"><td><p>18</p></td>
<td><p>NumEdges</p></td>
<td><p>Number of edges</p></td>
</tr>
<tr class="row-odd"><td><p>19</p></td>
<td><p>const32Bit</p></td>
<td><p>Number of occurrences of 32-bit integer constants</p></td>
</tr>
<tr class="row-even"><td><p>20</p></td>
<td><p>const64Bit</p></td>
<td><p>Number of occurrences of 64-bit integer constants</p></td>
</tr>
<tr class="row-odd"><td><p>21</p></td>
<td><p>numConstZeroes</p></td>
<td><p>Number of occurrences of constant 0</p></td>
</tr>
<tr class="row-even"><td><p>22</p></td>
<td><p>numConstOnes</p></td>
<td><p>Number of occurrences of constant 1</p></td>
</tr>
<tr class="row-odd"><td><p>23</p></td>
<td><p>UncondBranches</p></td>
<td><p>Number of unconditional branches</p></td>
</tr>
<tr class="row-even"><td><p>24</p></td>
<td><p>binaryConstArg</p></td>
<td><p>Binary operations with a constant operand</p></td>
</tr>
<tr class="row-odd"><td><p>25</p></td>
<td><p>NumAShrInst</p></td>
<td><p>Number of AShr instructions</p></td>
</tr>
<tr class="row-even"><td><p>26</p></td>
<td><p>NumAddInst</p></td>
<td><p>Number of Add instructions</p></td>
</tr>
<tr class="row-odd"><td><p>27</p></td>
<td><p>NumAllocaInst</p></td>
<td><p>Number of Alloca instructions</p></td>
</tr>
<tr class="row-even"><td><p>28</p></td>
<td><p>NumAndInst</p></td>
<td><p>Number of And instructions</p></td>
</tr>
<tr class="row-odd"><td><p>29</p></td>
<td><p>BlockMid</p></td>
<td><p>Number of basic blocks with instructions between [15, 500]</p></td>
</tr>
<tr class="row-even"><td><p>30</p></td>
<td><p>BlockLow</p></td>
<td><p>Number of basic blocks with less than 15 instructions</p></td>
</tr>
<tr class="row-odd"><td><p>31</p></td>
<td><p>NumBitCastInst</p></td>
<td><p>Number of BitCast instructions</p></td>
</tr>
<tr class="row-even"><td><p>32</p></td>
<td><p>NumBrInst</p></td>
<td><p>Number of Br instructions</p></td>
</tr>
<tr class="row-odd"><td><p>33</p></td>
<td><p>NumCallInst</p></td>
<td><p>Number of Call instructions</p></td>
</tr>
<tr class="row-even"><td><p>34</p></td>
<td><p>NumGetElementPtrInst</p></td>
<td><p>Number of GetElementPtr instructions</p></td>
</tr>
<tr class="row-odd"><td><p>35</p></td>
<td><p>NumICmpInst</p></td>
<td><p>Number of ICmp instructions</p></td>
</tr>
<tr class="row-even"><td><p>36</p></td>
<td><p>NumLShrInst</p></td>
<td><p>Number of LShr instructions</p></td>
</tr>
<tr class="row-odd"><td><p>37</p></td>
<td><p>NumLoadInst</p></td>
<td><p>Number of Load instructions</p></td>
</tr>
<tr class="row-even"><td><p>38</p></td>
<td><p>NumMulInst</p></td>
<td><p>Number of Mul instructions</p></td>
</tr>
<tr class="row-odd"><td><p>39</p></td>
<td><p>NumOrInst</p></td>
<td><p>Number of Or instructions</p></td>
</tr>
<tr class="row-even"><td><p>40</p></td>
<td><p>NumPHIInst</p></td>
<td><p>Number of PHI instructions</p></td>
</tr>
<tr class="row-odd"><td><p>41</p></td>
<td><p>NumRetInst</p></td>
<td><p>Number of Ret instructions</p></td>
</tr>
<tr class="row-even"><td><p>42</p></td>
<td><p>NumSExtInst</p></td>
<td><p>Number of SExt instructions</p></td>
</tr>
<tr class="row-odd"><td><p>43</p></td>
<td><p>NumSelectInst</p></td>
<td><p>Number of Select instructions</p></td>
</tr>
<tr class="row-even"><td><p>44</p></td>
<td><p>NumShlInst</p></td>
<td><p>Number of Shl instructions</p></td>
</tr>
<tr class="row-odd"><td><p>45</p></td>
<td><p>NumStoreInst</p></td>
<td><p>Number of Store instructions</p></td>
</tr>
<tr class="row-even"><td><p>46</p></td>
<td><p>NumSubInst</p></td>
<td><p>Number of Sub instructions</p></td>
</tr>
<tr class="row-odd"><td><p>47</p></td>
<td><p>NumTruncInst</p></td>
<td><p>Number of Trunc instructions</p></td>
</tr>
<tr class="row-even"><td><p>48</p></td>
<td><p>NumXorInst</p></td>
<td><p>Number of Xor instructions</p></td>
</tr>
<tr class="row-odd"><td><p>49</p></td>
<td><p>NumZExtInst</p></td>
<td><p>Number of ZExt instructions</p></td>
</tr>
<tr class="row-even"><td><p>50</p></td>
<td><p>TotalBlocks</p></td>
<td><p>Number of basic blocks</p></td>
</tr>
<tr class="row-odd"><td><p>51</p></td>
<td><p>TotalInsts</p></td>
<td><p>Number of instructions (of all types)</p></td>
</tr>
<tr class="row-even"><td><p>52</p></td>
<td><p>TotalMemInst</p></td>
<td><p>Number of memory instructions</p></td>
</tr>
<tr class="row-odd"><td><p>53</p></td>
<td><p>TotalFuncs</p></td>
<td><p>Number of non-external functions</p></td>
</tr>
<tr class="row-even"><td><p>54</p></td>
<td><p>ArgsPhi</p></td>
<td><p>Total arguments to Phi nodes</p></td>
</tr>
<tr class="row-odd"><td><p>55</p></td>
<td><p>testUnary</p></td>
<td><p>Number of Unary operations</p></td>
</tr>
</tbody>
</table>
<p>Example values:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">observation</span><span class="p">[</span><span class="s2">&quot;Autophase&quot;</span><span class="p">]</span>
<span class="go">array([   0,    0,   26,   25,    1,   26,   10,    1,    8,   10,    0,</span>
<span class="go">          0,    0,   37,    0,   36,    0,    2,   46,  175, 1664, 1212,</span>
<span class="go">        263,   26,  193,    0,   59,    6,    0,    3,   32,    0,   36,</span>
<span class="go">         10, 1058,   10,    0,  840,    0,    0,    0,    1,  416,    0,</span>
<span class="go">          0,  148,   60,    0,    0,    0,   37, 3008, 2062,    9,    0,</span>
<span class="go">       1262])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">observation</span><span class="p">[</span><span class="s2">&quot;AutophaseDict&quot;</span><span class="p">]</span>
<span class="go">{&#39;BBNumArgsHi&#39;: 0, &#39;BBNumArgsLo&#39;: 0, &#39;onePred&#39;: 26, &#39;onePredOneSuc&#39;: 25,</span>
<span class="go"> &#39;onePredTwoSuc&#39;: 1, &#39;oneSuccessor&#39;: 26, &#39;twoPred&#39;: 10, &#39;twoPredOneSuc&#39;: 1,</span>
<span class="go"> &#39;twoEach&#39;: 8, &#39;twoSuccessor&#39;: 10, &#39;morePreds&#39;: 0, &#39;BB03Phi&#39;: 0,</span>
<span class="go"> &#39;BBHiPhi&#39;: 0, &#39;BBNoPhi&#39;: 37, &#39;BeginPhi&#39;: 0, &#39;BranchCount&#39;: 36,</span>
<span class="go"> &#39;returnInt&#39;: 0, &#39;CriticalCount&#39;: 2, &#39;NumEdges&#39;: 46, &#39;const32Bit&#39;: 175,</span>
<span class="go"> &#39;const64Bit&#39;: 1664, &#39;numConstZeroes&#39;: 1212, &#39;numConstOnes&#39;: 263,</span>
<span class="go"> &#39;UncondBranches&#39;: 26, &#39;binaryConstArg&#39;: 193, &#39;NumAShrInst&#39;: 0,</span>
<span class="go"> &#39;NumAddInst&#39;: 59, &#39;NumAllocaInst&#39;: 6, &#39;NumAndInst&#39;: 0, &#39;BlockMid&#39;: 3,</span>
<span class="go"> &#39;BlockLow&#39;: 32, &#39;NumBitCastInst&#39;: 0, &#39;NumBrInst&#39;: 36, &#39;NumCallInst&#39;: 10, ... }</span>
</pre></div>
</div>
</section>
<section id="inst2vec">
<h3><a class="toc-backref" href="#id10">Inst2vec</a><a class="headerlink" href="#inst2vec" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Observation space</p></th>
<th class="head"><p>Shape</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Inst2vec</p></td>
<td><p><cite>ndarray_list&lt;&gt;[0,inf])</cite></p></td>
</tr>
<tr class="row-odd"><td><p>Inst2vecEmbeddingIndices</p></td>
<td><p><cite>int32_list&lt;&gt;[0,inf])</cite></p></td>
</tr>
<tr class="row-even"><td><p>Inst2vecPreprocessedText</p></td>
<td><p><cite>str_list&lt;&gt;[0,inf])</cite></p></td>
</tr>
</tbody>
</table>
<p>The inst2vec observation space represents LLVM-IR as sequence of embedding
vectors, one per LLVM statement, using embeddings trained offline on a large
corpus of LLVM-IR. It is described in:</p>
<blockquote>
<div><p>Ben-Nun, T., Jakobovits, A. S., &amp; Hoefler, T. (2018).
<a class="reference external" href="https://papers.nips.cc/paper/2018/file/17c3433fecc21b57000debdf7ad5c930-Paper.pdf">Neural code comprehension: A learnable representation of code semantics</a>.
In Advances in Neural Information Processing Systems (pp. 3585-3597).</p>
</div></blockquote>
<p>The inst2vec methodology comprises three steps, all of which are exposed as
observation spaces:</p>
<p><strong>Step 1: pre-processing</strong></p>
<p>The LLVM-IR statements are pre-processed to remove literals, identifiers, and
simplify the expressions. Using the Inst2vecPreprocessedText observation space
returns a list of pre-processed strings, one per statement. It could be useful
if you want to normalize the IR but then do your own embedding.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">observation</span><span class="p">[</span><span class="s2">&quot;Inst2vecPreprocessedText&quot;</span><span class="p">]</span>
<span class="go">[&#39;opaque = type opaque&#39;, ..., &#39;ret i32 &lt;%ID&gt;&#39;]</span>
</pre></div>
</div>
<p><strong>Step 2: encoding</strong></p>
<p>Each of the pre-processed statements is mapped to an index into a vocabulary of
over 8k LLVM-IR statements. If a statement is not found in the vocabulary, it
maps to a special !UNK vocabulary item. Using the Inst2vecEmbeddingIndices
observation space returns a list of vocabulary indices. This would be useful if
you want to learn your own embeddings using the same vocabulary, or if you want
to use the inst2vec pre-trained embeddings but are processing them on a GPU
where you have already allocated and copied the embedding table, minimizing
transfer sizes.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">observation</span><span class="p">[</span><span class="s2">&quot;Inst2vecEmbeddingIndices&quot;</span><span class="p">]</span>
<span class="go">[8564, 8564, 5, 46, ..., 257]</span>
</pre></div>
</div>
<p><strong>Step 3: embedding</strong></p>
<p>The vocabulary indices are mapped to 200-D embedding vectors, producing an
np.array of shape (num_statements, 200). This could be fed into an LSTM to
produce a program embedding.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">observation</span><span class="p">[</span><span class="s2">&quot;Inst2vec&quot;</span><span class="p">]</span>
<span class="go">array([[-0.26956588,  0.47407162, -0.36637706, ..., -0.49256894,</span>
<span class="go">         0.8016193 ,  0.71160674],</span>
<span class="go">       [-0.59749085,  0.63315004, -0.0308373 , ...,  0.14833118,</span>
<span class="go">         0.86420786,  0.44808227],</span>
<span class="go">       [-0.59749085,  0.63315004, -0.0308373 , ...,  0.14833118,</span>
<span class="go">         0.86420786,  0.44808227],</span>
<span class="go">       ...,</span>
<span class="go">       [-0.37584195,  0.43671703, -0.5360456 , ...,  0.6030259 ,</span>
<span class="go">         0.82574934,  0.6306344 ],</span>
<span class="go">       [-0.59749085,  0.63315004, -0.0308373 , ...,  0.14833118,</span>
<span class="go">         0.86420786,  0.44808227],</span>
<span class="go">       [-0.43074277,  0.8589559 , -0.35770646, ...,  0.28785184,</span>
<span class="go">         0.8492773 ,  0.8914213 ]], dtype=float32)</span>
</pre></div>
</div>
</section>
<section id="programl">
<h3><a class="toc-backref" href="#id11">ProGraML</a><a class="headerlink" href="#programl" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 68%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Observation space</p></th>
<th class="head"><p>Shape</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Programl</p></td>
<td><p><cite>str_list&lt;&gt;[0,inf]) -&gt; json://networkx/MultiDiGraph</cite></p></td>
</tr>
</tbody>
</table>
<p>The ProGraML representation is a graph-based representation of LLVM-IR which
includes control-flow, data-flow, and call-flow. This graph is represented as
an <a class="reference external" href="https://networkx.org/documentation/stable/reference/classes/multidigraph.html">nx.MultiDiGraph</a>.
ProGraML is described in:</p>
<blockquote>
<div><p>Cummins, C., Fisches, Z. V., Ben-Nun, T., Hoefler, T., &amp; Leather, H. (2020).
<a class="reference external" href="https://arxiv.org/pdf/2003.10536.pdf">ProGraML: Graph-based Deep Learning for Program Optimization and Analysis</a>.
arXiv preprint arXiv:2003.10536.</p>
</div></blockquote>
<p>Each node in the graph represents an instruction, a variable, or a constant. A
text attribute on each node can be used to produce an initial node embedding.
Each edge in the graph has a type and a position. There are three types of
edges: call edges, data edges, and control edges. An edge position is a positive
integer which encodes the operand order for data edges and the branch number for
control edges. The diagram below visualizes the ProGraML graph for a small
program.</p>
<img alt="../_images/programl.png" src="../_images/programl.png" />
<p>In the above diagram, each blue rectangular node represents an instruction, the
red diamonds are variables, the red ovals are constants, and the edges between
the nodes represent relations: blue edges are control flow, red edges are data
flow, and green edges are call flow.</p>
<p>Example usage:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">G</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">observation</span><span class="p">[</span><span class="s2">&quot;Programl&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">G</span>
<span class="go">&lt;networkx.classes.multidigraph.MultiDiGraph object at 0x7f9d8050ffa0&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
<span class="go">6326</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">1000</span><span class="p">]</span>
<span class="go">{&#39;block&#39;: 8, &#39;features&#39;: {&#39;full_text&#39;: [&#39;%439 = load double, double* @tmp2, align 8&#39;]}, &#39;function&#39;: 0, &#39;text&#39;: &#39;load&#39;, &#39;type&#39;: 0}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">G</span><span class="o">.</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="go">{&#39;flow&#39;: 2, &#39;position&#39;: 0}</span>
</pre></div>
</div>
</section>
<section id="hardware-information">
<h3><a class="toc-backref" href="#id12">Hardware Information</a><a class="headerlink" href="#hardware-information" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 8%" />
<col style="width: 92%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Observation space</p></th>
<th class="head"><p>Shape</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CpuInfo</p></td>
<td><p><cite>Dict(cores_count:int, l1d_cache_count:int, l1d_cache_size:int, l1i_cache_count:int, l1i_cache_size:int, l2_cache_count:int, l2_cache_size:int, l3_cache_count:int, l3_cache_size:int, l4_cache_count:int, l4_cache_size:int, name:str_list&lt;&gt;[0,inf]))</cite></p></td>
</tr>
</tbody>
</table>
<p>Essential performance information about the host CPU can be accessed as JSON
dictionary, extracted using the <a class="reference external" href="https://github.com/pytorch/cpuinfo">cpuinfo</a>
library.</p>
<p>This observation space is used for obtaining information about the target
hardware. The values are independent of the compiler and program state.</p>
<p>Example usage:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">observation</span><span class="p">[</span><span class="s2">&quot;CpuInfo&quot;</span><span class="p">]</span>
<span class="go">{&#39;cores_count&#39;: 8, &#39;l1d_cache_count&#39;: 8, ...}</span>
</pre></div>
</div>
</section>
<section id="cost-models">
<h3><a class="toc-backref" href="#id13">Cost Models</a><a class="headerlink" href="#cost-models" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 76%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Observation space</p></th>
<th class="head"><p>Shape</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>IrInstructionCount</p></td>
<td><p><cite>Box(0, 9223372036854775807, (1,), int64)</cite></p></td>
</tr>
<tr class="row-odd"><td><p>IrInstructionCountO0</p></td>
<td><p><cite>Box(0, 9223372036854775807, (1,), int64)</cite></p></td>
</tr>
<tr class="row-even"><td><p>IrInstructionCountO3</p></td>
<td><p><cite>Box(0, 9223372036854775807, (1,), int64)</cite></p></td>
</tr>
<tr class="row-odd"><td><p>IrInstructionCountOz</p></td>
<td><p><cite>Box(0, 9223372036854775807, (1,), int64)</cite></p></td>
</tr>
<tr class="row-even"><td><p>ObjectTextSizeBytes</p></td>
<td><p><cite>Box(0, 9223372036854775807, (1,), int64)</cite></p></td>
</tr>
<tr class="row-odd"><td><p>ObjectTextSizeO0</p></td>
<td><p><cite>Box(0, 9223372036854775807, (1,), int64)</cite></p></td>
</tr>
<tr class="row-even"><td><p>ObjectTextSizeO3</p></td>
<td><p><cite>Box(0, 9223372036854775807, (1,), int64)</cite></p></td>
</tr>
<tr class="row-odd"><td><p>ObjectTextSizeOz</p></td>
<td><p><cite>Box(0, 9223372036854775807, (1,), int64)</cite></p></td>
</tr>
</tbody>
</table>
<p>Raw values from the cost models used to compute <a class="reference internal" href="#reward"><span class="std std-ref">rewards</span></a>.</p>
</section>
<section id="runtime">
<h3><a class="toc-backref" href="#id14">Runtime</a><a class="headerlink" href="#runtime" title="Permalink to this heading"></a></h3>
<p>🏗️ <strong>Experimental API:</strong> This runtime observation space
is still in an experimental state and is not yet stable. There may be bugs and
breaking changes in future releases.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 76%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Observation space</p></th>
<th class="head"><p>Shape</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>IsRunnable</p></td>
<td><p><cite>int&lt;0,1&gt;</cite></p></td>
</tr>
<tr class="row-odd"><td><p>Runtime</p></td>
<td><p><cite>float64_list&lt;&gt;[0,inf])</cite></p></td>
</tr>
</tbody>
</table>
<p>Compile and run the benchmark, returning a list of wall-clock execution times.
Times are returned as floating point second values. The number of times that the
benchmark is executed is determined by the
<a class="reference internal" href="../compiler_gym/envs.html#compiler_gym.envs.LlvmEnv.runtime_observation_count" title="compiler_gym.envs.LlvmEnv.runtime_observation_count"><code class="xref py py-attr docutils literal notranslate"><span class="pre">LlvmEnv.runtime_observation_count</span></code></a> property.</p>
<p>Not all benchmarks are runnable. To check if the current benchmark is runnable,
use the <code class="code docutils literal notranslate"><span class="pre">IsRunnable</span></code> observation space, that is <code class="code docutils literal notranslate"><span class="pre">1</span></code> if the benchmark
is runnable, else <code class="code docutils literal notranslate"><span class="pre">0</span></code>. Requesting the <code class="code docutils literal notranslate"><span class="pre">Runtime</span></code> observation space
for a benchmark that is not runnable will return an empty list.</p>
</section>
<section id="build-time">
<h3><a class="toc-backref" href="#id15">Build Time</a><a class="headerlink" href="#build-time" title="Permalink to this heading"></a></h3>
<p>🏗️ <strong>Experimental API:</strong> This compiler time observation
space is still in an experimental state and is not yet stable. There may be bugs
and breaking changes in future releases.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 76%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Observation space</p></th>
<th class="head"><p>Shape</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>IsBuildable</p></td>
<td><p><cite>int&lt;0,1&gt;</cite></p></td>
</tr>
<tr class="row-odd"><td><p>Buildtime</p></td>
<td><p><cite>float64_list&lt;&gt;[0,inf])</cite></p></td>
</tr>
</tbody>
</table>
<p>Compile the benchmark to a binary and return a list of a single wall-clock build
time as seconds.</p>
<p>Not all benchmarks are build. To check if the current benchmark is buildable,
use the <code class="code docutils literal notranslate"><span class="pre">IsBuildable</span></code> observation space, that is <code class="code docutils literal notranslate"><span class="pre">1</span></code> if the
benchmark is buildable, else <code class="code docutils literal notranslate"><span class="pre">0</span></code>. Requesting the <code class="code docutils literal notranslate"><span class="pre">Buildtime</span></code>
observation space for a benchmark that is not buildable will return an empty
list.</p>
</section>
</section>
<section id="reward-spaces">
<span id="reward"></span><h2><a class="toc-backref" href="#id16">Reward Spaces</a><a class="headerlink" href="#reward-spaces" title="Permalink to this heading"></a></h2>
<p>The goal of CompilerGym tasks is to minimize a cost function <span class="math notranslate nohighlight">\(C(s)\)</span> which
takes as input the current program state <span class="math notranslate nohighlight">\(s\)</span> and produces a real-valued
cost. At a given timestep, reward is the reduction in cost from the previous
state <span class="math notranslate nohighlight">\(s_{t-1}\)</span> to the current state <span class="math notranslate nohighlight">\(s_t\)</span>:</p>
<div class="math notranslate nohighlight">
\[R(s_t) = C(s_{t-1}) - C(s_t)\]</div>
<p>Reward can be normalized using the cost of the program before any optimizations
are applied as the scaling factor:</p>
<div class="math notranslate nohighlight">
\[R(s_t) = \frac{C(s_{t-1}) - C(s_t)}{C(s_{t=0})}\]</div>
<p>Normalized rewards are indicated by a <code class="code docutils literal notranslate"><span class="pre">Norm</span></code> suffix on the reward space
name.</p>
<p>Alternatively, rewards can be normalized by comparison to a baseline policy. The
baseline policies are derived from existing
<a class="reference external" href="https://clang.llvm.org/docs/CommandGuide/clang.html#code-generation-options">LLVM optimization levels</a>:
<code class="code docutils literal notranslate"><span class="pre">-O3</span></code>, and <code class="code docutils literal notranslate"><span class="pre">-Oz</span></code>. When a baseline policy is used, reward is the
reduction in cost from the previous state, scaled by the <em>reduction in cost</em>
achieved by applying the baseline policy to produce a baseline state
<span class="math notranslate nohighlight">\(s_b\)</span>:</p>
<div class="math notranslate nohighlight">
\[R(s_t) = \frac{C(s_{t-1}) - C(s_t)}{{C(s_{t=0})} - C(s_b)}\]</div>
<p>These reward spaces are indicated by the baseline policy name as a suffix, e.g.
the reward space <code class="code docutils literal notranslate"><span class="pre">IrInstructionCountO3</span></code> is <code class="code docutils literal notranslate"><span class="pre">IrInstructionCount</span></code>
reward normalized to the <code class="code docutils literal notranslate"><span class="pre">-O3</span></code> baseline policy.</p>
<section id="ir-instruction-count">
<h3><a class="toc-backref" href="#id17">IR Instruction Count</a><a class="headerlink" href="#ir-instruction-count" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 15%" />
<col style="width: 11%" />
<col style="width: 18%" />
<col style="width: 16%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Reward space</p></th>
<th class="head"><p>Baseline Policy</p></th>
<th class="head"><p>Range</p></th>
<th class="head"><p>Success Threshold</p></th>
<th class="head"><p>Deterministic?</p></th>
<th class="head"><p>Platform dependent?</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>IrInstructionCount</p></td>
<td></td>
<td><p>(-inf, inf)</p></td>
<td></td>
<td><p>Yes</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p>IrInstructionCountNorm</p></td>
<td></td>
<td><p>(-inf, 1.0)</p></td>
<td></td>
<td><p>Yes</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-even"><td><p>IrInstructionCountO3</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">-O3</span></code></p></td>
<td><p>(-inf, inf)</p></td>
<td><p>1.0</p></td>
<td><p>Yes</p></td>
<td><p>No</p></td>
</tr>
<tr class="row-odd"><td><p>IrInstructionCountOz</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">-Oz</span></code></p></td>
<td><p>(-inf, inf)</p></td>
<td><p>1.0</p></td>
<td><p>Yes</p></td>
<td><p>No</p></td>
</tr>
</tbody>
</table>
<p>The number of LLVM-IR instructions in the program can be used as a reward
signal either using the raw change in instruction count
(<code class="code docutils literal notranslate"><span class="pre">IrInstructionCount</span></code>), or by scaling the changes in instruction count
to the improvement made by the baseline <code class="code docutils literal notranslate"><span class="pre">-O3</span></code> or <code class="code docutils literal notranslate"><span class="pre">-Oz</span></code> LLVM
pipelines. LLVM-IR instruction count is fast to evaluate, deterministic, and
platform-independent, but is not a measure of true codesize reduction as it does
not take into account the effects of lowering.</p>
</section>
<section id="codesize">
<h3><a class="toc-backref" href="#id18">Codesize</a><a class="headerlink" href="#codesize" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 15%" />
<col style="width: 11%" />
<col style="width: 18%" />
<col style="width: 16%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Reward space</p></th>
<th class="head"><p>Baseline Policy</p></th>
<th class="head"><p>Range</p></th>
<th class="head"><p>Success Threshold</p></th>
<th class="head"><p>Deterministic?</p></th>
<th class="head"><p>Platform dependent?</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ObjectTextSizeBytes</p></td>
<td></td>
<td><p>(-inf, inf)</p></td>
<td></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>ObjectTextSizeNorm</p></td>
<td></td>
<td><p>(-inf, 1.0)</p></td>
<td></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-even"><td><p>ObjectTextSizeO3</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">-O3</span></code></p></td>
<td><p>(-inf, inf)</p></td>
<td><p>1.0</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
</tr>
<tr class="row-odd"><td><p>ObjectTextSizeOz</p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">-Oz</span></code></p></td>
<td><p>(-inf, inf)</p></td>
<td><p>1.0</p></td>
<td><p>Yes</p></td>
<td><p>Yes</p></td>
</tr>
</tbody>
</table>
<p>The <code class="code docutils literal notranslate"><span class="pre">ObjectTextSizeBytes</span></code> reward signal returns the size of the
<code class="code docutils literal notranslate"><span class="pre">.TEXT</span></code> section of the module after lowering to an object file, before
linking. This is more expensive to compute than <code class="code docutils literal notranslate"><span class="pre">IrInstructionCount</span></code>. The
object file code size depends on the target platform, see
<a class="reference internal" href="../compiler_gym/envs.html#compiler_gym.envs.CompilerEnv.compiler_version" title="compiler_gym.envs.CompilerEnv.compiler_version"><code class="xref py py-func docutils literal notranslate"><span class="pre">CompilerEnv.compiler_version</span></code></a>.</p>
</section>
</section>
<section id="action-space">
<h2><a class="toc-backref" href="#id19">Action Space</a><a class="headerlink" href="#action-space" title="Permalink to this heading"></a></h2>
<p>The LLVM action space exposes the selection of semantics-preserving optimization
transforms as a discrete space.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 31%" />
<col style="width: 69%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Action</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>-add-discriminators</cite></p></td>
<td><p>Add DWARF path discriminators</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-adce</cite></p></td>
<td><p>Aggressive Dead Code Elimination</p></td>
</tr>
<tr class="row-even"><td><p><cite>-aggressive-instcombine</cite></p></td>
<td><p>Combine pattern based expressions</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-alignment-from-assumptions</cite></p></td>
<td><p>Alignment from assumptions</p></td>
</tr>
<tr class="row-even"><td><p><cite>-always-inline</cite></p></td>
<td><p>Inliner for always_inline functions</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-argpromotion</cite></p></td>
<td><p>Promote ‘by reference’ arguments to scalars</p></td>
</tr>
<tr class="row-even"><td><p><cite>-attributor</cite></p></td>
<td><p>Deduce and propagate attributes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-barrier</cite></p></td>
<td><p>A No-Op Barrier Pass</p></td>
</tr>
<tr class="row-even"><td><p><cite>-bdce</cite></p></td>
<td><p>Bit-Tracking Dead Code Elimination</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-break-crit-edges</cite></p></td>
<td><p>Break critical edges in CFG</p></td>
</tr>
<tr class="row-even"><td><p><cite>-simplifycfg</cite></p></td>
<td><p>Simplify the CFG</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-callsite-splitting</cite></p></td>
<td><p>Call-site splitting</p></td>
</tr>
<tr class="row-even"><td><p><cite>-called-value-propagation</cite></p></td>
<td><p>Called Value Propagation</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-canonicalize-aliases</cite></p></td>
<td><p>Canonicalize aliases</p></td>
</tr>
<tr class="row-even"><td><p><cite>-consthoist</cite></p></td>
<td><p>Constant Hoisting</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-constmerge</cite></p></td>
<td><p>Merge Duplicate Global Constants</p></td>
</tr>
<tr class="row-even"><td><p><cite>-constprop</cite></p></td>
<td><p>Simple constant propagation</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-coro-cleanup</cite></p></td>
<td><p>Lower all coroutine related intrinsics</p></td>
</tr>
<tr class="row-even"><td><p><cite>-coro-early</cite></p></td>
<td><p>Lower early coroutine intrinsics</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-coro-elide</cite></p></td>
<td><p>Coroutine frame allocation elision and indirect calls replacement</p></td>
</tr>
<tr class="row-even"><td><p><cite>-coro-split</cite></p></td>
<td><p>Split coroutine into a set of functions driving its state machine</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-correlated-propagation</cite></p></td>
<td><p>Value Propagation</p></td>
</tr>
<tr class="row-even"><td><p><cite>-cross-dso-cfi</cite></p></td>
<td><p>Cross-DSO CFI</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-deadargelim</cite></p></td>
<td><p>Dead Argument Elimination</p></td>
</tr>
<tr class="row-even"><td><p><cite>-dce</cite></p></td>
<td><p>Dead Code Elimination</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-die</cite></p></td>
<td><p>Dead Instruction Elimination</p></td>
</tr>
<tr class="row-even"><td><p><cite>-dse</cite></p></td>
<td><p>Dead Store Elimination</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-reg2mem</cite></p></td>
<td><p>Demote all values to stack slots</p></td>
</tr>
<tr class="row-even"><td><p><cite>-div-rem-pairs</cite></p></td>
<td><p>Hoist/decompose integer division and remainder</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-early-cse-memssa</cite></p></td>
<td><p>Early CSE w/ MemorySSA</p></td>
</tr>
<tr class="row-even"><td><p><cite>-elim-avail-extern</cite></p></td>
<td><p>Eliminate Available Externally Globals</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-ee-instrument</cite></p></td>
<td><p>Instrument function entry/exit with calls to e.g. mcount()(pre inlining)</p></td>
</tr>
<tr class="row-even"><td><p><cite>-flattencfg</cite></p></td>
<td><p>Flatten the CFG</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-float2int</cite></p></td>
<td><p>Float to int</p></td>
</tr>
<tr class="row-even"><td><p><cite>-forceattrs</cite></p></td>
<td><p>Force set function attributes</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-inline</cite></p></td>
<td><p>Function Integration/Inlining</p></td>
</tr>
<tr class="row-even"><td><p><cite>-insert-gcov-profiling</cite></p></td>
<td><p>Insert instrumentation for GCOV profiling</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-gvn-hoist</cite></p></td>
<td><p>Early GVN Hoisting of Expressions</p></td>
</tr>
<tr class="row-even"><td><p><cite>-gvn</cite></p></td>
<td><p>Global Value Numbering</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-globaldce</cite></p></td>
<td><p>Dead Global Elimination</p></td>
</tr>
<tr class="row-even"><td><p><cite>-globalopt</cite></p></td>
<td><p>Global Variable Optimizer</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-globalsplit</cite></p></td>
<td><p>Global splitter</p></td>
</tr>
<tr class="row-even"><td><p><cite>-guard-widening</cite></p></td>
<td><p>Widen guards</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-hotcoldsplit</cite></p></td>
<td><p>Hot Cold Splitting</p></td>
</tr>
<tr class="row-even"><td><p><cite>-ipconstprop</cite></p></td>
<td><p>Interprocedural constant propagation</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-ipsccp</cite></p></td>
<td><p>Interprocedural Sparse Conditional Constant Propagation</p></td>
</tr>
<tr class="row-even"><td><p><cite>-indvars</cite></p></td>
<td><p>Induction Variable Simplification</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-irce</cite></p></td>
<td><p>Inductive range check elimination</p></td>
</tr>
<tr class="row-even"><td><p><cite>-infer-address-spaces</cite></p></td>
<td><p>Infer address spaces</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-inferattrs</cite></p></td>
<td><p>Infer set function attributes</p></td>
</tr>
<tr class="row-even"><td><p><cite>-inject-tli-mappings</cite></p></td>
<td><p>Inject TLI Mappings</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-instsimplify</cite></p></td>
<td><p>Remove redundant instructions</p></td>
</tr>
<tr class="row-even"><td><p><cite>-instcombine</cite></p></td>
<td><p>Combine redundant instructions</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-instnamer</cite></p></td>
<td><p>Assign names to anonymous instructions</p></td>
</tr>
<tr class="row-even"><td><p><cite>-jump-threading</cite></p></td>
<td><p>Jump Threading</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-lcssa</cite></p></td>
<td><p>Loop-Closed SSA Form Pass</p></td>
</tr>
<tr class="row-even"><td><p><cite>-licm</cite></p></td>
<td><p>Loop Invariant Code Motion</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-libcalls-shrinkwrap</cite></p></td>
<td><p>Conditionally eliminate dead library calls</p></td>
</tr>
<tr class="row-even"><td><p><cite>-load-store-vectorizer</cite></p></td>
<td><p>Vectorize load and Store instructions</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-loop-data-prefetch</cite></p></td>
<td><p>Loop Data Prefetch</p></td>
</tr>
<tr class="row-even"><td><p><cite>-loop-deletion</cite></p></td>
<td><p>Delete dead loops</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-loop-distribute</cite></p></td>
<td><p>Loop Distribution</p></td>
</tr>
<tr class="row-even"><td><p><cite>-loop-fusion</cite></p></td>
<td><p>Loop Fusion</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-loop-guard-widening</cite></p></td>
<td><p>Widen guards (within a single loop, as a loop pass)</p></td>
</tr>
<tr class="row-even"><td><p><cite>-loop-idiom</cite></p></td>
<td><p>Recognize loop idioms</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-loop-instsimplify</cite></p></td>
<td><p>Simplify instructions in loops</p></td>
</tr>
<tr class="row-even"><td><p><cite>-loop-interchange</cite></p></td>
<td><p>Interchanges loops for cache reuse</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-loop-load-elim</cite></p></td>
<td><p>Loop Load Elimination</p></td>
</tr>
<tr class="row-even"><td><p><cite>-loop-predication</cite></p></td>
<td><p>Loop predication</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-loop-reroll</cite></p></td>
<td><p>Reroll loops</p></td>
</tr>
<tr class="row-even"><td><p><cite>-loop-rotate</cite></p></td>
<td><p>Rotate Loops</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-loop-simplifycfg</cite></p></td>
<td><p>Simplify loop CFG</p></td>
</tr>
<tr class="row-even"><td><p><cite>-loop-simplify</cite></p></td>
<td><p>Canonicalize natural loops</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-loop-sink</cite></p></td>
<td><p>Loop Sink</p></td>
</tr>
<tr class="row-even"><td><p><cite>-loop-reduce</cite></p></td>
<td><p>Loop Strength Reduction</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-loop-unroll-and-jam</cite></p></td>
<td><p>Unroll and Jam loops</p></td>
</tr>
<tr class="row-even"><td><p><cite>-loop-unroll</cite></p></td>
<td><p>Unroll loops</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-loop-unswitch</cite></p></td>
<td><p>Unswitch loops</p></td>
</tr>
<tr class="row-even"><td><p><cite>-loop-vectorize</cite></p></td>
<td><p>Loop Vectorization</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-loop-versioning-licm</cite></p></td>
<td><p>Loop Versioning For LICM</p></td>
</tr>
<tr class="row-even"><td><p><cite>-loop-versioning</cite></p></td>
<td><p>Loop Versioning</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-loweratomic</cite></p></td>
<td><p>Lower atomic intrinsics to non-atomic form</p></td>
</tr>
<tr class="row-even"><td><p><cite>-lower-constant-intrinsics</cite></p></td>
<td><p>Lower constant intrinsics</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-lower-expect</cite></p></td>
<td><p>Lower ‘expect’ Intrinsics</p></td>
</tr>
<tr class="row-even"><td><p><cite>-lower-guard-intrinsic</cite></p></td>
<td><p>Lower the guard intrinsic to normal control flow</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-lowerinvoke</cite></p></td>
<td><p>Lower invoke and unwind, for unwindless code generators</p></td>
</tr>
<tr class="row-even"><td><p><cite>-lower-matrix-intrinsics</cite></p></td>
<td><p>Lower the matrix intrinsics</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-lowerswitch</cite></p></td>
<td><p>Lower SwitchInst’s to branches</p></td>
</tr>
<tr class="row-even"><td><p><cite>-lower-widenable-condition</cite></p></td>
<td><p>Lower the widenable condition to default true value</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-memcpyopt</cite></p></td>
<td><p>MemCpy Optimization</p></td>
</tr>
<tr class="row-even"><td><p><cite>-mergefunc</cite></p></td>
<td><p>Merge Functions</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-mergeicmps</cite></p></td>
<td><p>Merge contiguous icmps into a memcmp</p></td>
</tr>
<tr class="row-even"><td><p><cite>-mldst-motion</cite></p></td>
<td><p>MergedLoadStoreMotion</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-sancov</cite></p></td>
<td><p>Pass for instrumenting coverage on functions</p></td>
</tr>
<tr class="row-even"><td><p><cite>-name-anon-globals</cite></p></td>
<td><p>Provide a name to nameless globals</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-nary-reassociate</cite></p></td>
<td><p>Nary reassociation</p></td>
</tr>
<tr class="row-even"><td><p><cite>-newgvn</cite></p></td>
<td><p>Global Value Numbering</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-pgo-memop-opt</cite></p></td>
<td><p>Optimize memory intrinsic using its size value profile</p></td>
</tr>
<tr class="row-even"><td><p><cite>-partial-inliner</cite></p></td>
<td><p>Partial Inliner</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-partially-inline-libcalls</cite></p></td>
<td><p>Partially inline calls to library functions</p></td>
</tr>
<tr class="row-even"><td><p><cite>-post-inline-ee-instrument</cite></p></td>
<td><p>Instrument function entry/exit with calls to e.g. mcount()” “(post inlining)</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-functionattrs</cite></p></td>
<td><p>Deduce function attributes</p></td>
</tr>
<tr class="row-even"><td><p><cite>-mem2reg</cite></p></td>
<td><p>Promote Memory to ” “Register</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-prune-eh</cite></p></td>
<td><p>Remove unused exception handling info</p></td>
</tr>
<tr class="row-even"><td><p><cite>-reassociate</cite></p></td>
<td><p>Reassociate expressions</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-redundant-dbg-inst-elim</cite></p></td>
<td><p>Redundant Dbg Instruction Elimination</p></td>
</tr>
<tr class="row-even"><td><p><cite>-rpo-functionattrs</cite></p></td>
<td><p>Deduce function attributes in RPO</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-rewrite-statepoints-for-gc</cite></p></td>
<td><p>Make relocations explicit at statepoints</p></td>
</tr>
<tr class="row-even"><td><p><cite>-sccp</cite></p></td>
<td><p>Sparse Conditional Constant Propagation</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-slp-vectorizer</cite></p></td>
<td><p>SLP Vectorizer</p></td>
</tr>
<tr class="row-even"><td><p><cite>-sroa</cite></p></td>
<td><p>Scalar Replacement Of Aggregates</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-scalarizer</cite></p></td>
<td><p>Scalarize vector operations</p></td>
</tr>
<tr class="row-even"><td><p><cite>-separate-const-offset-from-gep</cite></p></td>
<td><p>Split GEPs to a variadic base and a constant offset for better CSE</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-simple-loop-unswitch</cite></p></td>
<td><p>Simple unswitch loops</p></td>
</tr>
<tr class="row-even"><td><p><cite>-sink</cite></p></td>
<td><p>Code sinking</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-speculative-execution</cite></p></td>
<td><p>Speculatively execute instructions</p></td>
</tr>
<tr class="row-even"><td><p><cite>-slsr</cite></p></td>
<td><p>Straight line strength reduction</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-strip-dead-prototypes</cite></p></td>
<td><p>Strip Unused Function Prototypes</p></td>
</tr>
<tr class="row-even"><td><p><cite>-strip-debug-declare</cite></p></td>
<td><p>Strip all llvm.dbg.declare intrinsics</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-strip-nondebug</cite></p></td>
<td><p>Strip all symbols, except dbg symbols, from a module</p></td>
</tr>
<tr class="row-even"><td><p><cite>-strip</cite></p></td>
<td><p>Strip all symbols from a module</p></td>
</tr>
<tr class="row-odd"><td><p><cite>-tailcallelim</cite></p></td>
<td><p>Tail Call Elimination</p></td>
</tr>
<tr class="row-even"><td><p><cite>-mergereturn</cite></p></td>
<td><p>Unify function exit nodes</p></td>
</tr>
</tbody>
</table>
</section>
<section id="faq">
<h2><a class="toc-backref" href="#id20">FAQ</a><a class="headerlink" href="#faq" title="Permalink to this heading"></a></h2>
<section id="is-this-really-a-sequential-decision-process">
<h3><a class="toc-backref" href="#id21">Is this really a sequential decision process?</a><a class="headerlink" href="#is-this-really-a-sequential-decision-process" title="Permalink to this heading"></a></h3>
<p>Yes. Compilers frequently package individual transformations as “optimization
passes” which are then applied in a sequential order. Usually this order is
fixed (e.g. <a class="reference external" href="https://github.com/llvm/llvm-project/blob/71a8e4e7d6b947c8b954ec0763ff7969b3879d7b/llvm/lib/Transforms/IPO/PassManagerBuilder.cpp#L517-L922">real world example</a>).
The CompilerGym LLVM environment replaces that fixed order with a sequential
decision process where any pass may be applied at any stage.</p>
</section>
<section id="when-does-the-environment-consider-an-episode-done">
<h3><a class="toc-backref" href="#id22">When does the environment consider an episode “done”?</a><a class="headerlink" href="#when-does-the-environment-consider-an-episode-done" title="Permalink to this heading"></a></h3>
<p>The compiler itself doesn’t have a signal for termination. Actions are like
rewrite rules, it is up to the user to decide when no more improvement can be
achieved from further rewrites. E.g. for simple random search we can use
<a class="reference external" href="https://github.com/facebookresearch/CompilerGym/blob/8fa65c232d2bf6a7347af44565579c60775162ac/compiler_gym/bin/random_search.py#L33-L40">“patience”</a>.
The only exception is if the compiler crashes, or the code ends up in an
unexpected state - we have to abort. This happens.</p>
</section>
<section id="how-do-i-run-this-on-my-own-program">
<h3><a class="toc-backref" href="#id23">How do I run this on my own program?</a><a class="headerlink" href="#how-do-i-run-this-on-my-own-program" title="Permalink to this heading"></a></h3>
<p>By compiling your program to an unoptimized LLVM bitcode file. This can be done
automatically for C/C++ programs using the <a class="reference internal" href="api.html#compiler_gym.envs.llvm.make_benchmark" title="compiler_gym.envs.llvm.make_benchmark"><code class="xref py py-meth docutils literal notranslate"><span class="pre">env.make_benchmark()</span></code></a> API, or you can do this yourself using
clang:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ clang -emit-llvm -c -O0 -Xclang -disable-O0-optnone -Xclang -disable-llvm-passes myapp.c
</pre></div>
</div>
<p>Then pass the path of the generated <cite>.bc</cite> file to the CompilerGym command-line
tools using the <cite>–benchmark</cite> flag, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ bazel run -c opt //compiler_gym/bin:random_search -- \
    --env=llvm-ic-v0 \
    --benchmark=file:///$PWD/myapp.bc
</pre></div>
</div>
</section>
<section id="should-i-always-try-different-actions">
<h3><a class="toc-backref" href="#id24">Should I always try different actions?</a><a class="headerlink" href="#should-i-always-try-different-actions" title="Permalink to this heading"></a></h3>
<p>Some optimization actions may be called multiple times after other actions. An
example of this is <a class="reference external" href="https://en.wikipedia.org/wiki/Dead_code_elimination">dead code elimination</a>, which can be used to
“clean up mess” generated from a previous action. So repeating the same action
in different context can bring improvements.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../faq.html" class="btn btn-neutral float-left" title="Frequently Asked Questions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../envs/gcc.html" class="btn btn-neutral float-right" title="GCC Environment Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Meta Platforms, Inc.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WJN2CKJJKH"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-WJN2CKJJKH', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>