

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Command Line Reference &mdash; CompilerGym 0.2.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="RPC Service Reference" href="rpc.html" />
    <link rel="prev" title="About" href="about.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> CompilerGym
          

          
          </a>

          
            
            
              <div class="version">
                0.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Command Line Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-compiler_gym.bin.service">compiler_gym.bin.service</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#listing-available-environments">Listing available environments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#querying-the-capabilities-of-a-service">Querying the capabilities of a service</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-a-service">Running a Service</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-compiler_gym.bin.manual_env">compiler_gym.bin.manual_env</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#compilergym-shell-tutorial">CompilerGym Shell Tutorial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setting-a-benchmark-reward-and-observation">Setting a Benchmark, Reward and Observation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#actions-and-the-action-stack">Actions and the Action Stack</a></li>
<li class="toctree-l4"><a class="reference internal" href="#current-status">Current Status</a></li>
<li class="toctree-l4"><a class="reference internal" href="#searching">Searching</a></li>
<li class="toctree-l4"><a class="reference internal" href="#miscellaneous">Miscellaneous</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-compiler_gym.bin.random_search">compiler_gym.bin.random_search</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#search-strategy">Search strategy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#execution-strategy">Execution strategy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-compiler_gym.bin.random_replay">compiler_gym.bin.random_replay</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-compiler_gym.bin.validate">compiler_gym.bin.validate</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#input-format">Input Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output-format">Output Format</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="rpc.html">RPC Service Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption"><span class="caption-text">Environments</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="llvm/index.html">LLVM Environment Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="envs/gcc.html">GCC Environment Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="envs/loop_tool.html">loop_tool Environment Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Python API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="compiler_gym/compiler_gym.html">compiler_gym</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler_gym/datasets.html">compiler_gym.datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler_gym/envs.html">compiler_gym.envs</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler_gym/envs/gcc.html">compiler_gym.envs.gcc</a></li>
<li class="toctree-l1"><a class="reference internal" href="llvm/api.html">compiler_gym.envs.llvm</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler_gym/leaderboard.html">compiler_gym.leaderboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler_gym/service.html">compiler_gym.service</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler_gym/spaces.html">compiler_gym.spaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler_gym/views.html">compiler_gym.views</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiler_gym/wrappers.html">compiler_gym.wrappers</a></li>
</ul>
<p class="caption"><span class="caption-text">C++ API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cc/compiler_gym/envs/llvm/service.html">compiler_gym/envs/llvm/service</a></li>
<li class="toctree-l1"><a class="reference internal" href="cc/compiler_gym/service.html">compiler_gym/service</a></li>
<li class="toctree-l1"><a class="reference internal" href="cc/compiler_gym/service/runtime.html">compiler_gym/service/runtime</a></li>
<li class="toctree-l1"><a class="reference internal" href="cc/compiler_gym/util.html">compiler_gym/util</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CompilerGym</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Command Line Reference</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/cli.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="command-line-reference">
<h1>Command Line Reference<a class="headerlink" href="#command-line-reference" title="Permalink to this headline">¶</a></h1>
<p>Compiler Gym includes several command line tools in the <code class="code docutils literal notranslate"><span class="pre">compiler_gym.bin</span></code>
module. This document provides an overview of each module. Run any of the
commands with <code class="code docutils literal notranslate"><span class="pre">--helpfull</span></code> to examine the full usage options.</p>
<div class="contents local topic" id="command-line-tools">
<p class="topic-title">Command line tools:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#module-compiler_gym.bin.service" id="id1">compiler_gym.bin.service</a></p>
<ul>
<li><p><a class="reference internal" href="#listing-available-environments" id="id2">Listing available environments</a></p></li>
<li><p><a class="reference internal" href="#querying-the-capabilities-of-a-service" id="id3">Querying the capabilities of a service</a></p></li>
<li><p><a class="reference internal" href="#running-a-service" id="id4">Running a Service</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#module-compiler_gym.bin.manual_env" id="id5">compiler_gym.bin.manual_env</a></p>
<ul>
<li><p><a class="reference internal" href="#compilergym-shell-tutorial" id="id6">CompilerGym Shell Tutorial</a></p>
<ul>
<li><p><a class="reference internal" href="#setting-a-benchmark-reward-and-observation" id="id7">Setting a Benchmark, Reward and Observation</a></p></li>
<li><p><a class="reference internal" href="#actions-and-the-action-stack" id="id8">Actions and the Action Stack</a></p></li>
<li><p><a class="reference internal" href="#current-status" id="id9">Current Status</a></p></li>
<li><p><a class="reference internal" href="#searching" id="id10">Searching</a></p></li>
<li><p><a class="reference internal" href="#miscellaneous" id="id11">Miscellaneous</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#module-compiler_gym.bin.random_search" id="id12">compiler_gym.bin.random_search</a></p>
<ul>
<li><p><a class="reference internal" href="#search-strategy" id="id13">Search strategy</a></p></li>
<li><p><a class="reference internal" href="#execution-strategy" id="id14">Execution strategy</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#module-compiler_gym.bin.random_replay" id="id15">compiler_gym.bin.random_replay</a></p></li>
<li><p><a class="reference internal" href="#module-compiler_gym.bin.validate" id="id16">compiler_gym.bin.validate</a></p>
<ul>
<li><p><a class="reference internal" href="#input-format" id="id17">Input Format</a></p></li>
<li><p><a class="reference internal" href="#output-format" id="id18">Output Format</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="module-compiler_gym.bin.service">
<span id="compiler-gym-bin-service"></span><h2><a class="toc-backref" href="#id1">compiler_gym.bin.service</a><a class="headerlink" href="#module-compiler_gym.bin.service" title="Permalink to this headline">¶</a></h2>
<p>This program can be used to query and run the CompilerGym services.</p>
<div class="section" id="listing-available-environments">
<h3><a class="toc-backref" href="#id2">Listing available environments</a><a class="headerlink" href="#listing-available-environments" title="Permalink to this headline">¶</a></h3>
<p>List the environments that are available using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m compiler_gym.bin.service --ls_env
</pre></div>
</div>
</div>
<div class="section" id="querying-the-capabilities-of-a-service">
<h3><a class="toc-backref" href="#id3">Querying the capabilities of a service</a><a class="headerlink" href="#querying-the-capabilities-of-a-service" title="Permalink to this headline">¶</a></h3>
<p>Query the capabilities of a service using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m compiler_gym.bin.service --env=&lt;env&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m compiler_gym.bin.service --env=llvm-v0

Datasets
--------

+----------------------------+--------------------------+------------------------------+
| Dataset                    | Num. Benchmarks [#f1]_   | Description                  |
+============================+==========================+==============================+
| benchmark://anghabench-v0  | 1,042,976                | Compile-only C/C++ functions |
+----------------------------+--------------------------+------------------------------+
| benchmark://blas-v0        | 300                      | Basic linear algebra kernels |
+----------------------------+--------------------------+------------------------------+
...

Observation Spaces
------------------

+--------------------------+----------------------------------------------+
| Observation space        | Shape                                        |
+==========================+==============================================+
| Autophase                | `Box(0, 9223372036854775807, (56,), int64)`  |
+--------------------------+----------------------------------------------+
| AutophaseDict            | `Dict(ArgsPhi:int&lt;0,inf&gt;, BB03Phi:int&lt;0,...` |
+--------------------------+----------------------------------------------+
| BitcodeFile              | `str_list&lt;&gt;[0,4096.0])`                      |
+--------------------------+----------------------------------------------+
...
</pre></div>
</div>
<p>The output is tabular summaries of the environment’s datasets, observation
spaces, reward spaces, and action spaces, using reStructuredText syntax
(<a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/restructuredtext/basics.html#tables">https://www.sphinx-doc.org/en/master/usage/restructuredtext/basics.html#tables</a>).</p>
<p>To query the capabilities of an unmanaged service, use <code class="code docutils literal notranslate"><span class="pre">--service</span></code>. For
example, query a service running the <code class="code docutils literal notranslate"><span class="pre">llvm-v0</span></code> environment at
<code class="code docutils literal notranslate"><span class="pre">localhost:8080</span></code> using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m compiler_gym.bin.service --env=llvm-v0 --service=localhost:8080
</pre></div>
</div>
<p>To query the capability of a binary that implements the RPC service interface,
use the <code class="code docutils literal notranslate"><span class="pre">--local_service_binary</span></code> flag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m compiler_gym.bin.service --env=llvm-v0 --local_service_binary=/path/to/service/binary
</pre></div>
</div>
</div>
<div class="section" id="running-a-service">
<h3><a class="toc-backref" href="#id4">Running a Service</a><a class="headerlink" href="#running-a-service" title="Permalink to this headline">¶</a></h3>
<p>This module can also be used to launch a service that can then be connected to
by other environments. Start a service by specifying a port number using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m compiler_gym.bin.service --env=llvm-v0 --run_on_port=7777
</pre></div>
</div>
<p>Environment can connect to this service by passing the <code class="code docutils literal notranslate"><span class="pre">&lt;hostname&gt;:&lt;port&gt;</span></code>
address during environment initialization time. For example, in python:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span> <span class="o">=</span> <span class="n">compiler_gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s2">&quot;llvm-v0&quot;</span><span class="p">,</span> <span class="n">service</span><span class="o">=</span><span class="s2">&quot;localhost:7777&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Or at the command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m compiler_gym.bin.random_search --env=llvm-v0 --service=localhost:7777
</pre></div>
</div>
</div>
</div>
<div class="section" id="module-compiler_gym.bin.manual_env">
<span id="compiler-gym-bin-manual-env"></span><h2><a class="toc-backref" href="#id5">compiler_gym.bin.manual_env</a><a class="headerlink" href="#module-compiler_gym.bin.manual_env" title="Permalink to this headline">¶</a></h2>
<p>Run a CompilerGym environment with text interface controls.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m compiler_gym.bin.manual_env --env=&lt;env&gt; [--benchmark=&lt;name&gt;] [--observation=&lt;space&gt;] [--reward=&lt;space&gt;]
</pre></div>
</div>
<p>The benchmark to use can be specified using <code class="code docutils literal notranslate"><span class="pre">--benchmark=&lt;name&gt;</span></code>.</p>
<div class="section" id="compilergym-shell-tutorial">
<h3><a class="toc-backref" href="#id6">CompilerGym Shell Tutorial</a><a class="headerlink" href="#compilergym-shell-tutorial" title="Permalink to this headline">¶</a></h3>
<p>This program gives a basic shell through which many of commands from CompilerGym
can be executed. CompilerGym provides a simple Python interface to various
compiler functions, enabling programs to be compiled in different ways and to
make queries about those programs. The goal is to have a simple system for
machine learning in compilers.</p>
<div class="section" id="setting-a-benchmark-reward-and-observation">
<h4><a class="toc-backref" href="#id7">Setting a Benchmark, Reward and Observation</a><a class="headerlink" href="#setting-a-benchmark-reward-and-observation" title="Permalink to this headline">¶</a></h4>
<p>The CompilerGym operates on a program or benchmark. If not set on the command
line, the benchmark can be specified in the shell with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">cbench</span><span class="o">-</span><span class="n">v1</span><span class="o">/</span><span class="n">qsort</span><span class="o">&gt;</span> <span class="n">set_benchmark</span> <span class="o">&lt;</span><span class="n">benchmark</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>When a benchmark is set, the prompt will update with the name of the benchmark.
Supposing that is “bench”, then the prompt would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The list of available benchmarks can be shown with, though this is limited to
the first 200 benchmarks:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">list_benchmarks</span>
</pre></div>
</div>
<p>You can also see what datasets are available with this command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">cbench</span><span class="o">-</span><span class="n">v1</span><span class="o">/</span><span class="n">qsort</span><span class="o">&gt;</span> <span class="n">list_datasets</span>
</pre></div>
</div>
<p>The default reward and observation can be similarly set with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">set_default_reward</span> <span class="o">&lt;</span><span class="n">reward</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
<span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">set_default_observation</span> <span class="o">&lt;</span><span class="n">observation</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>And lists of the choices are available with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">list_rewards</span>
<span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">list_observations</span>
</pre></div>
</div>
<p>The default rewards and observations will be reported every time an action is
taken. So, if, for example, you want to see how the instruction count of the
benchmark program is affected by your actions, set the default reward to
“IrInstructionCount”. Then the change in instruction count for each action will
be reported.</p>
<p>Additionally, some of the search techniques require the default reward to be
set, since they will try to optimise that reward.</p>
</div>
<div class="section" id="actions-and-the-action-stack">
<h4><a class="toc-backref" href="#id8">Actions and the Action Stack</a><a class="headerlink" href="#actions-and-the-action-stack" title="Permalink to this headline">¶</a></h4>
<p>In CompilerGym an action corresponds to invoking an compiler operation
(currently an LLVM opt pass) on the intermediate representation of the program.
Each action acts on the result of the previous action and so on.</p>
<p>So, for example, to apply first the ‘tail call elimination’ pass, then the ‘loop
unrolling’ pass we call two actions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">action</span> <span class="o">-</span><span class="n">tailcallelim</span>
<span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">action</span> <span class="o">-</span><span class="n">loop</span><span class="o">-</span><span class="n">unroll</span>
</pre></div>
</div>
<p>Each action will report its default reward. Note that multiple actions can be
placed on a single line, so that the above is equivalent to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">action</span> <span class="o">-</span><span class="n">tailcallelim</span> <span class="o">-</span><span class="n">loop</span><span class="o">-</span><span class="n">unroll</span>
</pre></div>
</div>
<p>You can choose a random action, by using just a ‘-‘ as the action name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">action</span> <span class="o">-</span>
</pre></div>
</div>
<p>Since an empty line on the shell repeats the last action, you can execute many
random actions by typing that line first then holding down return.</p>
<p>The actions are recorded in a stack, with the latest action on the top of the
stack. You can view the action stack with stack command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">stack</span>
</pre></div>
</div>
<p>This will show for each action if it had an effect (as computed by the
underlying compiler), whether this terminated compiler, and what the per action
and cumulative rewards are.</p>
<p>The last action can be undone by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">undo</span>
</pre></div>
</div>
<p>All actions in the stack can be undone at once by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">reset</span>
</pre></div>
</div>
<p>You can find out what the effect of each action would be by calling this
command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">try_all_actions</span>
</pre></div>
</div>
<p>This will show a table with the reward for each action, sorted by best first.</p>
<p>If you have a large stack of actions, many of which are not profitable, you can
simplify the stack with this command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">simplify_stack</span>
</pre></div>
</div>
<p>This will redo the entire stack, keeping only those actions which previously
gave good rewards. (Note this doesn’t mean that the simplified stack will only
have positive rewards, some negative actions may be necessary set up for a later
positive reward.)</p>
</div>
<div class="section" id="current-status">
<h4><a class="toc-backref" href="#id9">Current Status</a><a class="headerlink" href="#current-status" title="Permalink to this headline">¶</a></h4>
<p>For the current state of the program - after whatever actions have been called
on it - you can make several queries.</p>
<p>The first is to get a reward. This might not be the same as the current default
reward:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">reward</span> <span class="o">&lt;</span><span class="n">reward</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>You can see various observations with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">observation</span> <span class="o">&lt;</span><span class="n">observation</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Finally, you can print the equivalent command line for achieving the same
behaviour as the actions through the standard system shell:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">commandline</span>
</pre></div>
</div>
</div>
<div class="section" id="searching">
<h4><a class="toc-backref" href="#id10">Searching</a><a class="headerlink" href="#searching" title="Permalink to this headline">¶</a></h4>
<p>Some very basic search capabilities are supported, directly in the shell. Each
of them just looks for another action to add.</p>
<p>First, is the random search through this command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">action</span> <span class="o">-</span>
</pre></div>
</div>
<p>Multiple steps can be taken by holding down the return key.</p>
<p>A hill-climbing search tries an action, but will only accept it if it yields a
positive reward:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">hill_climb</span> <span class="o">&lt;</span><span class="n">num</span><span class="o">-</span><span class="n">steps</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>A simple greedy search tries all possible actions and takes the one with the
highest reward, stopping when no action has a positive reward:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">greedy</span> <span class="o">&lt;</span><span class="n">num</span><span class="o">-</span><span class="n">steps</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="miscellaneous">
<h4><a class="toc-backref" href="#id11">Miscellaneous</a><a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h4>
<p>One useful command is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">breakpoint</span>
</pre></div>
</div>
<p>Which drops into the python debugger. This is very useful if you want to see
what is going on internally. There is a ‘self.env’ object that represents the
environment that is definitely worth exploring.</p>
<p>And finally:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compiler_gym</span><span class="p">:</span><span class="n">bench</span><span class="o">&gt;</span> <span class="n">exit</span>
</pre></div>
</div>
<p>Drops out of the shell. <code class="code docutils literal notranslate"><span class="pre">Ctrl-D</span></code> should have the same effect.</p>
</div>
</div>
</div>
<div class="section" id="module-compiler_gym.bin.random_search">
<span id="compiler-gym-bin-random-search"></span><h2><a class="toc-backref" href="#id12">compiler_gym.bin.random_search</a><a class="headerlink" href="#module-compiler_gym.bin.random_search" title="Permalink to this headline">¶</a></h2>
<p>Run a parallelized random search of an environment’s action space.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m compiler_gym.bin.random_search --env=&lt;env&gt; --benchmark=&lt;name&gt; [--runtime=&lt;sec&gt;]
</pre></div>
</div>
<p>This program runs a simple random agent on the action space of a single
benchmark. The best reward, and sequence of actions that produced this, are
logged to file.</p>
<p>For example, run a random search of the LLVM instruction count optimization
space on a Dijkstra benchmark for 60 seconds using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m compiler_gym.bin.random_search --env=llvm-ic-v0 --benchmark=cbench-v1/dijkstra --runtime=60
Started 16 worker threads for benchmark benchmark://cbench-v1/dijkstra (410 instructions) using reward IrInstructionCountOz.
=== Running for a minute ===
Runtime: a minute. Num steps: 470,407 (7,780 / sec). Num episodes: 4,616 (76 / sec). Num restarts: 0.
Best reward: 101.59% (96 passes, found after 35 seconds)
Ending jobs ... done
Step [000 / 096]: reward=0.621951
Step [001 / 096]: reward=0.621951, change=0.000000, action=AlwaysInlinerLegacyPass
...
Step [094 / 096]: reward=1.007905, change=0.066946, action=CfgsimplificationPass
Step [095 / 096]: reward=1.007905, change=0.000000, action=LoopVersioningPass
Step [096 / 096]: reward=1.015936, change=0.008031, action=NewGvnpass
</pre></div>
</div>
<div class="section" id="search-strategy">
<h3><a class="toc-backref" href="#id13">Search strategy</a><a class="headerlink" href="#search-strategy" title="Permalink to this headline">¶</a></h3>
<p>At each step, the agent selects an action randomly and records the
reward. After a number of steps without improving reward (the “patience” of the
agent), the agent terminates, and the environment resets. The number of steps
to take without making progress can be configured using the
<code class="code docutils literal notranslate"><span class="pre">--patience=&lt;num&gt;</span></code> flag.</p>
<p>Use <code class="code docutils literal notranslate"><span class="pre">--runtime</span></code> to limit the total runtime of the search. If not provided,
the search will run indefinitely. Use <code class="code docutils literal notranslate"><span class="pre">C-c</span></code> to cancel an in-progress
search.</p>
</div>
<div class="section" id="execution-strategy">
<h3><a class="toc-backref" href="#id14">Execution strategy</a><a class="headerlink" href="#execution-strategy" title="Permalink to this headline">¶</a></h3>
<p>The results of the search are logged to files. Control the location of these
logs using the <code class="code docutils literal notranslate"><span class="pre">--output_dir=/path</span></code> flag.</p>
<p>Multiple agents are run in parallel. By default, the number of agents is equal
to the number of processors on the host machine. Set a different value using
<code class="code docutils literal notranslate"><span class="pre">--nproc</span></code>.</p>
</div>
</div>
<div class="section" id="module-compiler_gym.bin.random_replay">
<span id="compiler-gym-bin-random-replay"></span><h2><a class="toc-backref" href="#id15">compiler_gym.bin.random_replay</a><a class="headerlink" href="#module-compiler_gym.bin.random_replay" title="Permalink to this headline">¶</a></h2>
<p>Replay the best solution found from a random search.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python -m compiler_gym.bin.random_replay --env=llvm-ic-v0 --output_dir=/path/to/logs
</pre></div>
</div>
<p>Given a set of <a class="reference internal" href="#module-compiler_gym.bin.random_search" title="compiler_gym.bin.random_search"><code class="xref py py-mod docutils literal notranslate"><span class="pre">compiler_gym.bin.random_search</span></code></a> logs generated from a
prior search, replay the best sequence of actions found and record the
incremental reward of each action.</p>
</div>
<div class="section" id="module-compiler_gym.bin.validate">
<span id="compiler-gym-bin-validate"></span><h2><a class="toc-backref" href="#id16">compiler_gym.bin.validate</a><a class="headerlink" href="#module-compiler_gym.bin.validate" title="Permalink to this headline">¶</a></h2>
<p>Validate environment states.</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat &lt;&lt; EOF |
benchmark,reward,walltime,commandline
cbench-v1/crc32,0,1.2,opt  input.bc -o output.bc
EOF
python -m compiler_gym.bin.validate --env=llvm-ic-v0 -
</pre></div>
</div>
<p>Use this script to validate environment states. Environment states are read from
stdin as a comma-separated list of benchmark names, walltimes, episode rewards,
and commandlines. Each state is validated by replaying the commandline and
validating that the reward matches the expected value. Further, some benchmarks
allow for validation of program semantics. When available, those additional
checks will be automatically run.</p>
<div class="section" id="input-format">
<h3><a class="toc-backref" href="#id17">Input Format</a><a class="headerlink" href="#input-format" title="Permalink to this headline">¶</a></h3>
<p>The correct format for generating input states can be generated using
<a class="reference internal" href="compiler_gym/compiler_gym.html#compiler_gym.CompilerEnvStateWriter" title="compiler_gym.CompilerEnvStateWriter"><code class="xref py py-class docutils literal notranslate"><span class="pre">CompilerEnvStateWriter</span></code></a>. For
.. rubric:: Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s2">&quot;llvm-autophase-ic-v0&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">sample</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">CompilerEnvStateWriter</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;results.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">))</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">writer</span><span class="o">.</span><span class="n">write_state</span><span class="p">(</span><span class="n">env</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="output-format">
<h3><a class="toc-backref" href="#id18">Output Format</a><a class="headerlink" href="#output-format" title="Permalink to this headline">¶</a></h3>
<p>This script prints one line per input state. The order of input states is not
preserved. A successfully validated state has the format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>✅  &lt;benchmark_name&gt;  &lt;reproduced_reward&gt;
</pre></div>
</div>
<p>Else if validation fails, the output is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>❌  &lt;benchmark_name&gt;  &lt;error_details&gt;
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="rpc.html" class="btn btn-neutral float-right" title="RPC Service Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="about.html" class="btn btn-neutral float-left" title="About" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright Facebook AI Research.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'G-T95G5EVYXM', 'auto');
    
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>